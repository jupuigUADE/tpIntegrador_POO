<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/org/db/DatabaseTest.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/db/DatabaseTest.java" />
              <option name="originalContent" value="package org.db;&#10;&#10;import org.db.DatabaseHelper;&#10;import org.models.*;&#10;import java.util.List;&#10;import java.util.ArrayList;&#10;import java.time.LocalDateTime;&#10;&#10;public class DatabaseTest {&#10;    public static void main(String[] args) {&#10;        System.out.println(&quot;=== Complete Restaurant Database Test ===&quot;);&#10;        &#10;        // Create database helper&#10;        DatabaseHelper db = new DatabaseHelper();&#10;        &#10;        // Test connection&#10;        db.testConnection();&#10;        &#10;        // Test User operations&#10;        System.out.println(&quot;\n=== Testing User Operations ===&quot;);&#10;        testUsers(db);&#10;        &#10;        // Test Mesa operations&#10;        System.out.println(&quot;\n=== Testing Mesa Operations ===&quot;);&#10;        testMesas(db);&#10;        &#10;        // Test Ingrediente operations&#10;        System.out.println(&quot;\n=== Testing Ingrediente Operations ===&quot;);&#10;        testIngredientes(db);&#10;        &#10;        // Test Stock operations&#10;        System.out.println(&quot;\n=== Testing Stock Operations ===&quot;);&#10;        testStock(db);&#10;        &#10;        // Test Recipe operations&#10;        System.out.println(&quot;\n=== Testing Recipe Operations ===&quot;);&#10;        testRecipes(db);&#10;        &#10;        // Test Reservation operations&#10;        System.out.println(&quot;\n=== Testing Reservation Operations ===&quot;);&#10;        testReservations(db);&#10;        &#10;        // Close database connection&#10;        db.close();&#10;        &#10;        System.out.println(&quot;\n=== Complete Database Test Finished ===&quot;);&#10;    }&#10;    &#10;    private static void testUsers(DatabaseHelper db) {&#10;        // Insert some test users&#10;        User admin = new User(&quot;admin&quot;, true);&#10;        User waiter = new User(&quot;waiter1&quot;, false);&#10;        User chef = new User(&quot;chef1&quot;, false);&#10;        &#10;        if (db.insertUser(admin)) {&#10;            System.out.println(&quot;✓ Admin user inserted successfully&quot;);&#10;        }&#10;        if (db.insertUser(waiter)) {&#10;            System.out.println(&quot;✓ Waiter user inserted successfully&quot;);&#10;        }&#10;        if (db.insertUser(chef)) {&#10;            System.out.println(&quot;✓ Chef user inserted successfully&quot;);&#10;        }&#10;        &#10;        // Retrieve all users&#10;        List&lt;User&gt; users = db.getAllUsers();&#10;        System.out.println(&quot;\nAll users in database:&quot;);&#10;        for (User user : users) {&#10;            System.out.println(&quot;- &quot; + user.getUsername() + &#10;                             (user.isAdmin() ? &quot; (Admin)&quot; : &quot; (Regular)&quot;));&#10;        }&#10;    }&#10;    &#10;    private static void testMesas(DatabaseHelper db) {&#10;        // Insert some test mesas&#10;        Mesa mesa1 = new Mesa(1, 4);&#10;        Mesa mesa2 = new Mesa(2, 2);&#10;        Mesa mesa3 = new Mesa(3, 6);&#10;        mesa2.setEstado(TableStatus.OCUPADA);&#10;        &#10;        db.insertMesa(mesa1);&#10;        db.insertMesa(mesa2);&#10;        db.insertMesa(mesa3);&#10;        System.out.println(&quot;✓ 3 mesas inserted successfully&quot;);&#10;        &#10;        // Retrieve all mesas&#10;        List&lt;Mesa&gt; mesas = db.getAllMesas();&#10;        System.out.println(&quot;\nAll mesas in database:&quot;);&#10;        for (Mesa mesa : mesas) {&#10;            System.out.println(&quot;- Mesa &quot; + mesa.getId() + &#10;                             &quot; (Capacity: &quot; + mesa.getCapacidad() + &#10;                             &quot;, Status: &quot; + mesa.getEstado() + &quot;)&quot;);&#10;        }&#10;    }&#10;    &#10;    private static void testIngredientes(DatabaseHelper db) {&#10;        // Insert some test ingredientes&#10;        Ingrediente tomate = new Ingrediente(1, &quot;Tomate&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente queso = new Ingrediente(2, &quot;Queso&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente harina = new Ingrediente(3, &quot;Harina&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente aceite = new Ingrediente(4, &quot;Aceite&quot;, Magnitud.LITRO);&#10;        &#10;        db.insertIngrediente(tomate);&#10;        db.insertIngrediente(queso);&#10;        db.insertIngrediente(harina);&#10;        db.insertIngrediente(aceite);&#10;        System.out.println(&quot;✓ 4 ingredientes inserted successfully&quot;);&#10;        &#10;        // Retrieve all ingredientes&#10;        List&lt;Ingrediente&gt; ingredientes = db.getAllIngredientes();&#10;        System.out.println(&quot;\nAll ingredientes in database:&quot;);&#10;        for (Ingrediente ingrediente : ingredientes) {&#10;            System.out.println(&quot;- &quot; + ingrediente.getNombre() + &#10;                             &quot; (ID: &quot; + ingrediente.getId() + &#10;                             &quot;, Unit: &quot; + ingrediente.getUnidadMedida() + &quot;)&quot;);&#10;        }&#10;    }&#10;    &#10;    private static void testStock(DatabaseHelper db) {&#10;        // Get ingredientes to create stock&#10;        List&lt;Ingrediente&gt; ingredientes = db.getAllIngredientes();&#10;        &#10;        // Create stock for each ingrediente&#10;        for (Ingrediente ingrediente : ingredientes) {&#10;            double cantidadInicial = 10.0; // Start with 10 units&#10;            int cantidadMinima = 2; // Minimum 2 units&#10;            DetalleIngrediente stock = new DetalleIngrediente(ingrediente, cantidadInicial, cantidadMinima);&#10;            db.insertStock(stock);&#10;        }&#10;        System.out.println(&quot;✓ Stock created for all ingredientes&quot;);&#10;        &#10;        // Retrieve all stock&#10;        List&lt;DetalleIngrediente&gt; stockList = db.getAllStock();&#10;        System.out.println(&quot;\nCurrent stock levels:&quot;);&#10;        for (DetalleIngrediente stock : stockList) {&#10;            System.out.println(&quot;- &quot; + stock.getIngrediente().getNombre() +&#10;                             &quot;: &quot; + stock.getCantidadActual() + &quot; &quot; + &#10;                             stock.getIngrediente().getUnidadMedida() +&#10;                             (stock.necesitaReorden() ? &quot; (NEEDS REORDER)&quot; : &quot;&quot;));&#10;        }&#10;        &#10;        // Test stock update&#10;        if (!stockList.isEmpty()) {&#10;            DetalleIngrediente firstStock = stockList.get(0);&#10;            int ingredienteId = firstStock.getIngrediente().getId();&#10;            double newAmount = 1.5; // Update to low amount&#10;            &#10;            if (db.updateStock(ingredienteId, newAmount)) {&#10;                System.out.println(&quot;✓ Updated stock for &quot; + firstStock.getIngrediente().getNombre() + &#10;                                 &quot; to &quot; + newAmount);&#10;            }&#10;        }&#10;    }&#10;    &#10;    private static void testRecipes(DatabaseHelper db) {&#10;        // Get ingredientes for recipes&#10;        Ingrediente tomate = db.getIngredienteById(1);&#10;        Ingrediente queso = db.getIngredienteById(2);&#10;        Ingrediente harina = db.getIngredienteById(3);&#10;        &#10;        if (tomate != null &amp;&amp; queso != null &amp;&amp; harina != null) {&#10;            // Create pizza recipe&#10;            List&lt;RecipeIngredient&gt; pizzaIngredientes = new ArrayList&lt;&gt;();&#10;            pizzaIngredientes.add(new RecipeIngredient(harina, 0.5)); // 0.5 kg harina&#10;            pizzaIngredientes.add(new RecipeIngredient(tomate, 0.2)); // 0.2 kg tomate&#10;            pizzaIngredientes.add(new RecipeIngredient(queso, 0.3)); // 0.3 kg queso&#10;            &#10;            Recipe pizza = new Recipe(1, &quot;Pizza Margherita&quot;, pizzaIngredientes, 25, 15);&#10;            &#10;            if (db.insertRecipe(pizza)) {&#10;                System.out.println(&quot;✓ Pizza recipe inserted successfully&quot;);&#10;            }&#10;            &#10;            // Create pasta recipe&#10;            List&lt;RecipeIngredient&gt; pastaIngredientes = new ArrayList&lt;&gt;();&#10;            pastaIngredientes.add(new RecipeIngredient(harina, 0.3)); // 0.3 kg harina&#10;            pastaIngredientes.add(new RecipeIngredient(tomate, 0.4)); // 0.4 kg tomate&#10;            &#10;            Recipe pasta = new Recipe(2, &quot;Pasta con Tomate&quot;, pastaIngredientes, 15, 12);&#10;            &#10;            if (db.insertRecipe(pasta)) {&#10;                System.out.println(&quot;✓ Pasta recipe inserted successfully&quot;);&#10;            }&#10;        }&#10;        &#10;        // Retrieve all recipes&#10;        List&lt;Recipe&gt; recipes = db.getAllRecipes();&#10;        System.out.println(&quot;\nAll recipes in database:&quot;);&#10;        for (Recipe recipe : recipes) {&#10;            System.out.println(&quot;- &quot; + recipe.getNombre() + &#10;                             &quot; (ID: &quot; + recipe.getId() + &#10;                             &quot;, Prep time: &quot; + recipe.getTiempoPreparacionMinutos() + &quot; min)&quot;);&#10;            for (RecipeIngredient ri : recipe.getIngredientes()) {&#10;                System.out.println(&quot;  * &quot; + ri.getIngrediente().getNombre() + &#10;                                 &quot;: &quot; + ri.getCantidad() + &quot; &quot; + &#10;                                 ri.getIngrediente().getUnidadMedida());&#10;            }&#10;        }&#10;    }&#10;    &#10;    private static void testReservations(DatabaseHelper db) {&#10;        // Create some test reservations&#10;        LocalDateTime tomorrow = LocalDateTime.now().plusDays(1).withHour(19).withMinute(0);&#10;        LocalDateTime dayAfter = LocalDateTime.now().plusDays(2).withHour(20).withMinute(30);&#10;        &#10;        Reservation res1 = new Reservation(1, &quot;Juan Pérez&quot;, 4, tomorrow);&#10;        Reservation res2 = new Reservation(2, &quot;María García&quot;, 2, dayAfter);&#10;        res2.setTableId(2); // Assign table 2&#10;        res2.setStatus(ReservationStatus.CONFIRMED);&#10;        &#10;        if (db.insertReservation(res1)) {&#10;            System.out.println(&quot;✓ Reservation 1 inserted successfully&quot;);&#10;        }&#10;        if (db.insertReservation(res2)) {&#10;            System.out.println(&quot;✓ Reservation 2 inserted successfully&quot;);&#10;        }&#10;        &#10;        // Retrieve all reservations&#10;        List&lt;Reservation&gt; reservations = db.getAllReservations();&#10;        System.out.println(&quot;\nAll reservations in database:&quot;);&#10;        for (Reservation reservation : reservations) {&#10;            System.out.println(&quot;- &quot; + reservation.getCustomerName() + &#10;                             &quot; (&quot; + reservation.getGuests() + &quot; guests)&quot; +&#10;                             &quot; at &quot; + reservation.getWhen() +&#10;                             &quot; [Status: &quot; + reservation.getStatus() + &#10;                             (reservation.getTableId() != null ? &#10;                                 &quot;, Table: &quot; + reservation.getTableId() : &quot;, No table assigned&quot;) + &quot;]&quot;);&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package org.db;&#10;&#10;import org.db.DatabaseHelper;&#10;import org.models.*;&#10;import java.util.List;&#10;import java.util.ArrayList;&#10;import java.time.LocalDateTime;&#10;&#10;public class DatabaseTest {&#10;    public static void main(String[] args) {&#10;        System.out.println(&quot;=== Complete Restaurant Database Test ===&quot;);&#10;        &#10;        // Create database helper&#10;        DatabaseHelper db = new DatabaseHelper();&#10;        &#10;        // Test connection&#10;        db.testConnection();&#10;        &#10;        // Test User operations&#10;        System.out.println(&quot;\n=== Testing User Operations ===&quot;);&#10;        testUsers(db);&#10;        &#10;        // Test Mesa operations&#10;        System.out.println(&quot;\n=== Testing Mesa Operations ===&quot;);&#10;        testMesas(db);&#10;        &#10;        // Test Ingrediente operations&#10;        System.out.println(&quot;\n=== Testing Ingrediente Operations ===&quot;);&#10;        testIngredientes(db);&#10;        &#10;        // Test Stock operations&#10;        System.out.println(&quot;\n=== Testing Stock Operations ===&quot;);&#10;        testStock(db);&#10;        &#10;        // Test Recipe operations&#10;        System.out.println(&quot;\n=== Testing Recipe Operations ===&quot;);&#10;        testRecipes(db);&#10;        &#10;        // Test Reservation operations&#10;        System.out.println(&quot;\n=== Testing Reservation Operations ===&quot;);&#10;        testReservations(db);&#10;        &#10;        // Close database connection&#10;        db.close();&#10;        &#10;        System.out.println(&quot;\n=== Complete Database Test Finished ===&quot;);&#10;    }&#10;    &#10;    private static void testUsers(DatabaseHelper db) {&#10;        // Insert some test users&#10;        Admin admin = new Admin(&quot;admin&quot;);&#10;        Waiter waiter = new Waiter(&quot;waiter1&quot;);&#10;        Chef chef = new Chef(&quot;chef1&quot;);&#10;        &#10;        if (db.insertUser(admin)) {&#10;            System.out.println(&quot;✓ Admin user inserted successfully&quot;);&#10;        }&#10;        if (db.insertUser(waiter)) {&#10;            System.out.println(&quot;✓ Waiter user inserted successfully&quot;);&#10;        }&#10;        if (db.insertUser(chef)) {&#10;            System.out.println(&quot;✓ Chef user inserted successfully&quot;);&#10;        }&#10;        &#10;        // Retrieve all users&#10;        List&lt;User&gt; users = db.getAllUsers();&#10;        System.out.println(&quot;\nAll users in database:&quot;);&#10;        for (User user : users) {&#10;            System.out.println(&quot;- &quot; + user.getUsername() + &#10;                             (user.isAdmin() ? &quot; (Admin)&quot; : user.isChef() ? &quot; (Chef)&quot; : &quot; (Waiter)&quot;));&#10;        }&#10;    }&#10;    &#10;    private static void testMesas(DatabaseHelper db) {&#10;        // Insert some test mesas&#10;        Mesa mesa1 = new Mesa(1, 4);&#10;        Mesa mesa2 = new Mesa(2, 2);&#10;        Mesa mesa3 = new Mesa(3, 6);&#10;        mesa2.setEstado(TableStatus.OCUPADA);&#10;        &#10;        db.insertMesa(mesa1);&#10;        db.insertMesa(mesa2);&#10;        db.insertMesa(mesa3);&#10;        System.out.println(&quot;✓ 3 mesas inserted successfully&quot;);&#10;        &#10;        // Retrieve all mesas&#10;        List&lt;Mesa&gt; mesas = db.getAllMesas();&#10;        System.out.println(&quot;\nAll mesas in database:&quot;);&#10;        for (Mesa mesa : mesas) {&#10;            System.out.println(&quot;- Mesa &quot; + mesa.getId() + &#10;                             &quot; (Capacity: &quot; + mesa.getCapacidad() + &#10;                             &quot;, Status: &quot; + mesa.getEstado() + &quot;)&quot;);&#10;        }&#10;    }&#10;    &#10;    private static void testIngredientes(DatabaseHelper db) {&#10;        // Insert some test ingredientes&#10;        Ingrediente tomate = new Ingrediente(1, &quot;Tomate&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente queso = new Ingrediente(2, &quot;Queso&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente harina = new Ingrediente(3, &quot;Harina&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente aceite = new Ingrediente(4, &quot;Aceite&quot;, Magnitud.LITRO);&#10;        &#10;        db.insertIngrediente(tomate);&#10;        db.insertIngrediente(queso);&#10;        db.insertIngrediente(harina);&#10;        db.insertIngrediente(aceite);&#10;        System.out.println(&quot;✓ 4 ingredientes inserted successfully&quot;);&#10;        &#10;        // Retrieve all ingredientes&#10;        List&lt;Ingrediente&gt; ingredientes = db.getAllIngredientes();&#10;        System.out.println(&quot;\nAll ingredientes in database:&quot;);&#10;        for (Ingrediente ingrediente : ingredientes) {&#10;            System.out.println(&quot;- &quot; + ingrediente.getNombre() + &#10;                             &quot; (ID: &quot; + ingrediente.getId() + &#10;                             &quot;, Unit: &quot; + ingrediente.getUnidadMedida() + &quot;)&quot;);&#10;        }&#10;    }&#10;    &#10;    private static void testStock(DatabaseHelper db) {&#10;        // Get ingredientes to create stock&#10;        List&lt;Ingrediente&gt; ingredientes = db.getAllIngredientes();&#10;        &#10;        // Create stock for each ingrediente&#10;        for (Ingrediente ingrediente : ingredientes) {&#10;            double cantidadInicial = 10.0; // Start with 10 units&#10;            int cantidadMinima = 2; // Minimum 2 units&#10;            DetalleIngrediente stock = new DetalleIngrediente(ingrediente, cantidadInicial, cantidadMinima);&#10;            db.insertStock(stock);&#10;        }&#10;        System.out.println(&quot;✓ Stock created for all ingredientes&quot;);&#10;        &#10;        // Retrieve all stock&#10;        List&lt;DetalleIngrediente&gt; stockList = db.getAllStock();&#10;        System.out.println(&quot;\nCurrent stock levels:&quot;);&#10;        for (DetalleIngrediente stock : stockList) {&#10;            System.out.println(&quot;- &quot; + stock.getIngrediente().getNombre() +&#10;                             &quot;: &quot; + stock.getCantidadActual() + &quot; &quot; + &#10;                             stock.getIngrediente().getUnidadMedida() +&#10;                             (stock.necesitaReorden() ? &quot; (NEEDS REORDER)&quot; : &quot;&quot;));&#10;        }&#10;        &#10;        // Test stock update&#10;        if (!stockList.isEmpty()) {&#10;            DetalleIngrediente firstStock = stockList.get(0);&#10;            int ingredienteId = firstStock.getIngrediente().getId();&#10;            double newAmount = 1.5; // Update to low amount&#10;            &#10;            if (db.updateStock(ingredienteId, newAmount)) {&#10;                System.out.println(&quot;✓ Updated stock for &quot; + firstStock.getIngrediente().getNombre() + &#10;                                 &quot; to &quot; + newAmount);&#10;            }&#10;        }&#10;    }&#10;    &#10;    private static void testRecipes(DatabaseHelper db) {&#10;        // Get ingredientes for recipes&#10;        Ingrediente tomate = db.getIngredienteById(1);&#10;        Ingrediente queso = db.getIngredienteById(2);&#10;        Ingrediente harina = db.getIngredienteById(3);&#10;        &#10;        if (tomate != null &amp;&amp; queso != null &amp;&amp; harina != null) {&#10;            // Create pizza recipe&#10;            List&lt;RecipeIngredient&gt; pizzaIngredientes = new ArrayList&lt;&gt;();&#10;            pizzaIngredientes.add(new RecipeIngredient(harina, 0.5)); // 0.5 kg harina&#10;            pizzaIngredientes.add(new RecipeIngredient(tomate, 0.2)); // 0.2 kg tomate&#10;            pizzaIngredientes.add(new RecipeIngredient(queso, 0.3)); // 0.3 kg queso&#10;            &#10;            Recipe pizza = new Recipe(1, &quot;Pizza Margherita&quot;, pizzaIngredientes, 25, 15);&#10;            &#10;            if (db.insertRecipe(pizza)) {&#10;                System.out.println(&quot;✓ Pizza recipe inserted successfully&quot;);&#10;            }&#10;            &#10;            // Create pasta recipe&#10;            List&lt;RecipeIngredient&gt; pastaIngredientes = new ArrayList&lt;&gt;();&#10;            pastaIngredientes.add(new RecipeIngredient(harina, 0.3)); // 0.3 kg harina&#10;            pastaIngredientes.add(new RecipeIngredient(tomate, 0.4)); // 0.4 kg tomate&#10;            &#10;            Recipe pasta = new Recipe(2, &quot;Pasta con Tomate&quot;, pastaIngredientes, 15, 12);&#10;            &#10;            if (db.insertRecipe(pasta)) {&#10;                System.out.println(&quot;✓ Pasta recipe inserted successfully&quot;);&#10;            }&#10;        }&#10;        &#10;        // Retrieve all recipes&#10;        List&lt;Recipe&gt; recipes = db.getAllRecipes();&#10;        System.out.println(&quot;\nAll recipes in database:&quot;);&#10;        for (Recipe recipe : recipes) {&#10;            System.out.println(&quot;- &quot; + recipe.getNombre() + &#10;                             &quot; (ID: &quot; + recipe.getId() + &#10;                             &quot;, Prep time: &quot; + recipe.getTiempoPreparacionMinutos() + &quot; min)&quot;);&#10;            for (RecipeIngredient ri : recipe.getIngredientes()) {&#10;                System.out.println(&quot;  * &quot; + ri.getIngrediente().getNombre() + &#10;                                 &quot;: &quot; + ri.getCantidad() + &quot; &quot; + &#10;                                 ri.getIngrediente().getUnidadMedida());&#10;            }&#10;        }&#10;    }&#10;    &#10;    private static void testReservations(DatabaseHelper db) {&#10;        // Create some test reservations&#10;        LocalDateTime tomorrow = LocalDateTime.now().plusDays(1).withHour(19).withMinute(0);&#10;        LocalDateTime dayAfter = LocalDateTime.now().plusDays(2).withHour(20).withMinute(30);&#10;        &#10;        Reservation res1 = new Reservation(1, &quot;Juan Pérez&quot;, 4, tomorrow);&#10;        Reservation res2 = new Reservation(2, &quot;María García&quot;, 2, dayAfter);&#10;        res2.setTableId(2); // Assign table 2&#10;        res2.setStatus(ReservationStatus.CONFIRMED);&#10;        &#10;        if (db.insertReservation(res1)) {&#10;            System.out.println(&quot;✓ Reservation 1 inserted successfully&quot;);&#10;        }&#10;        if (db.insertReservation(res2)) {&#10;            System.out.println(&quot;✓ Reservation 2 inserted successfully&quot;);&#10;        }&#10;        &#10;        // Retrieve all reservations&#10;        List&lt;Reservation&gt; reservations = db.getAllReservations();&#10;        System.out.println(&quot;\nAll reservations in database:&quot;);&#10;        for (Reservation reservation : reservations) {&#10;            System.out.println(&quot;- &quot; + reservation.getCustomerName() + &#10;                             &quot; (&quot; + reservation.getGuests() + &quot; guests)&quot; +&#10;                             &quot; at &quot; + reservation.getWhen() +&#10;                             &quot; [Status: &quot; + reservation.getStatus() + &#10;                             (reservation.getTableId() != null ? &#10;                                 &quot;, Table: &quot; + reservation.getTableId() : &quot;, No table assigned&quot;) + &quot;]&quot;);&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/db/UserManager.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/db/UserManager.java" />
              <option name="originalContent" value="package org.db;&#10;&#10;import org.models.*;&#10;import java.security.MessageDigest;&#10;import java.security.NoSuchAlgorithmException;&#10;import java.sql.*;&#10;&#10;public class UserManager {&#10;    private static final String DB_URL = &quot;jdbc:sqlite:./restaurant.db&quot;;&#10;    private Connection connection;&#10;    &#10;    public UserManager() {&#10;        try {&#10;            Class.forName(&quot;org.sqlite.JDBC&quot;);&#10;            connection = DriverManager.getConnection(DB_URL);&#10;            createPasswordTable();&#10;        } catch (SQLException | ClassNotFoundException e) {&#10;            System.err.println(&quot;Error conectando a la base de datos: &quot; + e.getMessage());&#10;        }&#10;    }&#10;    &#10;    private void createPasswordTable() {&#10;        String sql = &quot;&quot;&quot;&#10;            CREATE TABLE IF NOT EXISTS user_passwords (&#10;                username TEXT PRIMARY KEY,&#10;                password_hash TEXT NOT NULL,&#10;                FOREIGN KEY (username) REFERENCES users(username)&#10;            )&#10;            &quot;&quot;&quot;;&#10;        &#10;        try (Statement stmt = connection.createStatement()) {&#10;            stmt.execute(sql);&#10;            System.out.println(&quot;Tabla de contraseñas de usuarios creada exitosamente&quot;);&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error creando tabla user_passwords: &quot; + e.getMessage());&#10;        }&#10;    }&#10;    &#10;    private String hashPassword(String password) {&#10;        try {&#10;            MessageDigest md = MessageDigest.getInstance(&quot;SHA-256&quot;);&#10;            byte[] hashedBytes = md.digest(password.getBytes());&#10;            StringBuilder sb = new StringBuilder();&#10;            for (byte b : hashedBytes) {&#10;                sb.append(String.format(&quot;%02x&quot;, b));&#10;            }&#10;            return sb.toString();&#10;        } catch (NoSuchAlgorithmException e) {&#10;            throw new RuntimeException(&quot;SHA-256 not available&quot;, e);&#10;        }&#10;    }&#10;    &#10;    public boolean createUserWithPassword(String username, boolean isAdmin, String password) {&#10;        try {&#10;            connection.setAutoCommit(false);&#10;            &#10;            // First create the user&#10;            String userSql = &quot;INSERT OR IGNORE INTO users (username, admin) VALUES (?, ?)&quot;;&#10;            try (PreparedStatement pstmt = connection.prepareStatement(userSql)) {&#10;                pstmt.setString(1, username);&#10;                pstmt.setBoolean(2, isAdmin);&#10;        &#10;        try (PreparedStatement pstmt = connection.prepareStatement(sql)) {&#10;            pstmt.setString(1, username);&#10;            &#10;            try (ResultSet rs = pstmt.executeQuery()) {&#10;                if (rs.next()) {&#10;                    String storedHash = rs.getString(&quot;password_hash&quot;);&#10;                    String inputHash = hashPassword(password);&#10;                    return storedHash.equals(inputHash);&#10;                }&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error autenticando usuario: &quot; + e.getMessage());&#10;        }&#10;        &#10;        return false;&#10;    }&#10;    &#10;    public boolean changePassword(String username, String oldPassword, String newPassword) {&#10;        if (!authenticateUser(username, oldPassword)) {&#10;            return false;&#10;        }&#10;        &#10;        String sql = &quot;UPDATE user_passwords SET password_hash = ? WHERE username = ?&quot;;&#10;        &#10;        try (PreparedStatement pstmt = connection.prepareStatement(sql)) {&#10;            pstmt.setString(1, hashPassword(newPassword));&#10;            pstmt.setString(2, username);&#10;            &#10;            int rowsAffected = pstmt.executeUpdate();&#10;            return rowsAffected &gt; 0;&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error changing password: &quot; + e.getMessage());&#10;            return false;&#10;        }&#10;    }&#10;    &#10;    public void initializeDefaultUsers() {&#10;        // Create default users with passwords&#10;        boolean admin = createUserWithPassword(&quot;admin&quot;, true, &quot;admin123&quot;);&#10;        boolean waiter = createUserWithPassword(&quot;waiter1&quot;, false, &quot;waiter123&quot;);&#10;        boolean chef = createUserWithPassword(&quot;chef1&quot;, false, &quot;chef123&quot;);&#10;        &#10;        if (admin &amp;&amp; waiter &amp;&amp; chef) {&#10;            System.out.println(&quot;✓ Default users initialized successfully:&quot;);&#10;            System.out.println(&quot;- admin / admin123 (Admin)&quot;);&#10;            System.out.println(&quot;- waiter1 / waiter123 (Regular)&quot;);&#10;            System.out.println(&quot;- chef1 / chef123 (Regular)&quot;);&#10;        } else {&#10;            System.out.println(&quot;⚠ Some users may already exist or there was an error&quot;);&#10;        }&#10;    }&#10;    &#10;    public void close() {&#10;        try {&#10;            if (connection != null &amp;&amp; !connection.isClosed()) {&#10;                connection.close();&#10;                System.out.println(&quot;UserManager database connection closed&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error closing database connection: &quot; + e.getMessage());&#10;        }&#10;    }&#10;}" />
              <option name="updatedContent" value="package org.db;&#10;&#10;import org.models.*;&#10;import java.security.MessageDigest;&#10;import java.security.NoSuchAlgorithmException;&#10;import java.sql.*;&#10;&#10;public class UserManager {&#10;    private static final String DB_URL = &quot;jdbc:sqlite:./restaurant.db&quot;;&#10;    private Connection connection;&#10;    &#10;    public UserManager() {&#10;        try {&#10;            Class.forName(&quot;org.sqlite.JDBC&quot;);&#10;            connection = DriverManager.getConnection(DB_URL);&#10;            createPasswordTable();&#10;        } catch (SQLException | ClassNotFoundException e) {&#10;            System.err.println(&quot;Error conectando a la base de datos: &quot; + e.getMessage());&#10;        }&#10;    }&#10;    &#10;    private void createPasswordTable() {&#10;        String sql = &quot;&quot;&quot;&#10;            CREATE TABLE IF NOT EXISTS user_passwords (&#10;                username TEXT PRIMARY KEY,&#10;                password_hash TEXT NOT NULL,&#10;                FOREIGN KEY (username) REFERENCES users(username)&#10;            )&#10;            &quot;&quot;&quot;;&#10;        &#10;        try (Statement stmt = connection.createStatement()) {&#10;            stmt.execute(sql);&#10;            System.out.println(&quot;Tabla de contraseñas de usuarios creada exitosamente&quot;);&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error creando tabla user_passwords: &quot; + e.getMessage());&#10;        }&#10;    }&#10;    &#10;    private String hashPassword(String password) {&#10;        try {&#10;            MessageDigest md = MessageDigest.getInstance(&quot;SHA-256&quot;);&#10;            byte[] hashedBytes = md.digest(password.getBytes());&#10;            StringBuilder sb = new StringBuilder();&#10;            for (byte b : hashedBytes) {&#10;                sb.append(String.format(&quot;%02x&quot;, b));&#10;            }&#10;            return sb.toString();&#10;        } catch (NoSuchAlgorithmException e) {&#10;            throw new RuntimeException(&quot;SHA-256 not available&quot;, e);&#10;        }&#10;    }&#10;    &#10;    public boolean createUserWithPassword(String username, boolean isAdmin, String password) {&#10;        try {&#10;            connection.setAutoCommit(false);&#10;            &#10;            // First create the user (include role)&#10;            String userSql = &quot;INSERT OR IGNORE INTO users (username, admin, role) VALUES (?, ?, ?)&quot;;&#10;            try (PreparedStatement pstmt = connection.prepareStatement(userSql)) {&#10;                pstmt.setString(1, username);&#10;                pstmt.setBoolean(2, isAdmin);&#10;                String role = &quot;WAITER&quot;;&#10;                if (isAdmin) role = &quot;ADMIN&quot;;&#10;                else if (username != null &amp;&amp; username.toLowerCase().contains(&quot;chef&quot;)) role = &quot;CHEF&quot;;&#10;                pstmt.setString(3, role);&#10;                pstmt.executeUpdate();&#10;            }&#10;            &#10;            // Then add the password&#10;            String passwordSql = &quot;INSERT OR REPLACE INTO user_passwords (username, password_hash) VALUES (?, ?)&quot;;&#10;            try (PreparedStatement pstmt = connection.prepareStatement(passwordSql)) {&#10;                pstmt.setString(1, username);&#10;                pstmt.setString(2, hashPassword(password));&#10;                pstmt.executeUpdate();&#10;            }&#10;            &#10;            connection.commit();&#10;            connection.setAutoCommit(true);&#10;            return true;&#10;        } catch (SQLException e) {&#10;            try {&#10;                connection.rollback();&#10;                connection.setAutoCommit(true);&#10;            } catch (SQLException ex) {&#10;                System.err.println(&quot;Error revirtiendo transacción: &quot; + ex.getMessage());&#10;            }&#10;            System.err.println(&quot;Error creando usuario con contraseña: &quot; + e.getMessage());&#10;            return false;&#10;        }&#10;    }&#10;    &#10;    public boolean authenticateUser(String username, String password) {&#10;        String sql = &quot;SELECT password_hash FROM user_passwords WHERE username = ?&quot;;&#10;        &#10;        try (PreparedStatement pstmt = connection.prepareStatement(sql)) {&#10;            pstmt.setString(1, username);&#10;            &#10;            try (ResultSet rs = pstmt.executeQuery()) {&#10;                if (rs.next()) {&#10;                    String storedHash = rs.getString(&quot;password_hash&quot;);&#10;                    String inputHash = hashPassword(password);&#10;                    return storedHash.equals(inputHash);&#10;                }&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error autenticando usuario: &quot; + e.getMessage());&#10;        }&#10;        &#10;        return false;&#10;    }&#10;    &#10;    public boolean changePassword(String username, String oldPassword, String newPassword) {&#10;        if (!authenticateUser(username, oldPassword)) {&#10;            return false;&#10;        }&#10;        &#10;        String sql = &quot;UPDATE user_passwords SET password_hash = ? WHERE username = ?&quot;;&#10;        &#10;        try (PreparedStatement pstmt = connection.prepareStatement(sql)) {&#10;            pstmt.setString(1, hashPassword(newPassword));&#10;            pstmt.setString(2, username);&#10;            &#10;            int rowsAffected = pstmt.executeUpdate();&#10;            return rowsAffected &gt; 0;&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error changing password: &quot; + e.getMessage());&#10;            return false;&#10;        }&#10;    }&#10;    &#10;    public void initializeDefaultUsers() {&#10;        // Create default users with passwords&#10;        boolean admin = createUserWithPassword(&quot;admin&quot;, true, &quot;admin123&quot;);&#10;        boolean waiter = createUserWithPassword(&quot;waiter1&quot;, false, &quot;waiter123&quot;);&#10;        boolean chef = createUserWithPassword(&quot;chef1&quot;, false, &quot;chef123&quot;);&#10;        &#10;        if (admin &amp;&amp; waiter &amp;&amp; chef) {&#10;            System.out.println(&quot;✓ Default users initialized successfully:&quot;);&#10;            System.out.println(&quot;- admin / admin123 (Admin)&quot;);&#10;            System.out.println(&quot;- waiter1 / waiter123 (Regular)&quot;);&#10;            System.out.println(&quot;- chef1 / chef123 (Regular)&quot;);&#10;        } else {&#10;            System.out.println(&quot;⚠ Some users may already exist or there was an error&quot;);&#10;        }&#10;    }&#10;    &#10;    public void close() {&#10;        try {&#10;            if (connection != null &amp;&amp; !connection.isClosed()) {&#10;                connection.close();&#10;                System.out.println(&quot;UserManager database connection closed&quot;);&#10;            }&#10;        } catch (SQLException e) {&#10;            System.err.println(&quot;Error closing database connection: &quot; + e.getMessage());&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/example/Main.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/example/Main.java" />
              <option name="originalContent" value="package org.example;&#10;&#10;import org.gui.MainGui;&#10;import org.models.*;&#10;&#10;import javax.swing.SwingUtilities;&#10;import java.util.List;&#10;&#10;public class Main {&#10;    public static void main(String[] args) {&#10;        // Build initial model data&#10;        StockGeneral sistemaStock = new StockGeneral();&#10;&#10;        Ingrediente harina = new Ingrediente(101, &quot;Harina de Trigo&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente queso = new Ingrediente(202, &quot;Queso Mozzarella&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente tomate = new Ingrediente(303, &quot;Tomate&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente levadura = new Ingrediente(404, &quot;Levadura&quot;, Magnitud.GRAMO);&#10;&#10;        DetalleIngrediente stockHarina = new DetalleIngrediente(harina, 50.0, 10);&#10;        DetalleIngrediente stockQueso = new DetalleIngrediente(queso, 25.0, 5);&#10;        DetalleIngrediente stockTomate = new DetalleIngrediente(tomate, 20.0, 5);&#10;        DetalleIngrediente stockLevadura = new DetalleIngrediente(levadura, 1000.0, 200);&#10;&#10;        sistemaStock.agregarStock(stockHarina);&#10;        sistemaStock.agregarStock(stockQueso);&#10;        sistemaStock.agregarStock(stockTomate);&#10;        sistemaStock.agregarStock(stockLevadura);&#10;&#10;        // Build menu / recipes&#10;        Menu menu = new Menu();&#10;&#10;        Recipe pizza = new Recipe(&#10;                1,&#10;                &quot;Pizza Margarita&quot;,&#10;                List.of(&#10;                        new RecipeIngredient(harina, 0.3),&#10;                        new RecipeIngredient(levadura, 5.0),&#10;                        new RecipeIngredient(tomate, 0.2),&#10;                        new RecipeIngredient(queso, 0.25)&#10;                ),&#10;                20,&#10;                15&#10;        );&#10;&#10;        Recipe pan = new Recipe(&#10;                2,&#10;                &quot;Pan Casero&quot;,&#10;                List.of(&#10;                        new RecipeIngredient(harina, 0.5),&#10;                        new RecipeIngredient(levadura, 7.0)&#10;                ),&#10;                40,&#10;                8&#10;        );&#10;&#10;        menu.addRecipe(pizza);&#10;        menu.addRecipe(pan);&#10;&#10;        // Tables and reservations&#10;        TableService tableService = new TableService();&#10;        tableService.addMesa(new Mesa(1, 2));&#10;        tableService.addMesa(new Mesa(2, 4));&#10;        tableService.addMesa(new Mesa(3, 4));&#10;        tableService.addMesa(new Mesa(4, 6));&#10;" />
              <option name="updatedContent" value="package org.example;&#10;&#10;import org.gui.MainGui;&#10;import org.models.*;&#10;&#10;import javax.swing.SwingUtilities;&#10;import java.util.List;&#10;&#10;public class Main {&#10;    public static void main(String[] args) {&#10;        // Build initial model data&#10;        StockGeneral sistemaStock = new StockGeneral();&#10;&#10;        Ingrediente harina = new Ingrediente(101, &quot;Harina de Trigo&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente queso = new Ingrediente(202, &quot;Queso Mozzarella&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente tomate = new Ingrediente(303, &quot;Tomate&quot;, Magnitud.KILOGRAMO);&#10;        Ingrediente levadura = new Ingrediente(404, &quot;Levadura&quot;, Magnitud.GRAMO);&#10;&#10;        DetalleIngrediente stockHarina = new DetalleIngrediente(harina, 50.0, 10);&#10;        DetalleIngrediente stockQueso = new DetalleIngrediente(queso, 25.0, 5);&#10;        DetalleIngrediente stockTomate = new DetalleIngrediente(tomate, 20.0, 5);&#10;        DetalleIngrediente stockLevadura = new DetalleIngrediente(levadura, 1000.0, 200);&#10;&#10;        sistemaStock.agregarStock(stockHarina);&#10;        sistemaStock.agregarStock(stockQueso);&#10;        sistemaStock.agregarStock(stockTomate);&#10;        sistemaStock.agregarStock(stockLevadura);&#10;&#10;        // Build menu / recipes&#10;        Menu menu = new Menu();&#10;&#10;        Recipe pizza = new Recipe(&#10;                1,&#10;                &quot;Pizza Margarita&quot;,&#10;                List.of(&#10;                        new RecipeIngredient(harina, 0.3),&#10;                        new RecipeIngredient(levadura, 5.0),&#10;                        new RecipeIngredient(tomate, 0.2),&#10;                        new RecipeIngredient(queso, 0.25)&#10;                ),&#10;                20,&#10;                15&#10;        );&#10;&#10;        Recipe pan = new Recipe(&#10;                2,&#10;                &quot;Pan Casero&quot;,&#10;                List.of(&#10;                        new RecipeIngredient(harina, 0.5),&#10;                        new RecipeIngredient(levadura, 7.0)&#10;                ),&#10;                40,&#10;                8&#10;        );&#10;&#10;        menu.addRecipe(pizza);&#10;        menu.addRecipe(pan);&#10;&#10;        // Tables and reservations&#10;        TableService tableService = new TableService();&#10;        tableService.addMesa(new Mesa(1, 2));&#10;        tableService.addMesa(new Mesa(2, 4));&#10;        tableService.addMesa(new Mesa(3, 4));&#10;        tableService.addMesa(new Mesa(4, 6));&#10;        // Additional tables&#10;        tableService.addMesa(new Mesa(5, 2));&#10;        tableService.addMesa(new Mesa(6, 2));&#10;        tableService.addMesa(new Mesa(7, 4));&#10;        tableService.addMesa(new Mesa(8, 6));&#10;&#10;        ReservationService reservationService = new ReservationService(tableService);&#10;&#10;        // Production service&#10;        Pedido productionService = new Pedido(sistemaStock);&#10;&#10;        // Wire production integration so orders create production jobs and ETAs&#10;        tableService.setProductionIntegration(productionService, menu);&#10;&#10;        // Start Swing UI on EDT after prompting for login&#10;        SwingUtilities.invokeLater(() -&gt; {&#10;            User user = org.example.LoginDialog.showLogin(null);&#10;            if (user == null) {&#10;                // User cancelled login; exit application&#10;                System.out.println(&quot;Ningún usuario inició sesión. Cerrando aplicación.&quot;);&#10;                System.exit(0);&#10;            }&#10;&#10;            MainGui gui = new MainGui(sistemaStock, menu, reservationService, tableService, productionService, user);&#10;            gui.setVisible(true);&#10;        });&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/gui/TablesPanel.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/gui/TablesPanel.java" />
              <option name="originalContent" value="package org.gui;&#10;&#10;import org.models.Mesa;&#10;import org.models.Menu;&#10;import org.models.Reservation;&#10;import org.models.ReservationService;&#10;import org.models.TableService;&#10;import org.models.OrderItem;&#10;import org.models.Recipe;&#10;import org.models.Factura;&#10;import org.exceptions.TableNotFoundException;&#10;import org.exceptions.ReservationNotFoundException;&#10;&#10;import javax.swing.*;&#10;import javax.swing.table.DefaultTableModel;&#10;import java.awt.*;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import javax.swing.SwingUtilities;&#10;import java.awt.event.MouseAdapter;&#10;import java.awt.event.MouseEvent;&#10;import java.awt.event.ActionEvent;&#10;import javax.swing.AbstractAction;&#10;&#10;public class TablesPanel extends JPanel {&#10;    private final TableService tableService;&#10;    private final ReservationService reservationService;&#10;    private final Menu menu;&#10;     private final DefaultTableModel tableModel;&#10;     private final JTable table;&#10;     private final JButton btnRefresh;&#10;     private final JButton btnAssign;&#10;     private final JButton btnSeat;&#10;     private final JButton btnRelease;&#10;&#10;    // Floor map panel and buttons per table&#10;    private final JPanel floorPanel;&#10;    private final Map&lt;Integer, JButton&gt; tableButtons = new HashMap&lt;&gt;();&#10;&#10;    // Orders UI&#10;    private final DefaultListModel&lt;OrderItem&gt; ordersModel;&#10;    private final JList&lt;OrderItem&gt; ordersList;&#10;    private final JButton btnAddOrder;&#10;    private final JButton btnClearOrders;&#10;    private final JButton btnEditOrders;&#10;    private final JButton btnGetBill;&#10;&#10;    public TablesPanel(TableService tableService, ReservationService reservationService, Menu menu) {&#10;        super(new BorderLayout());&#10;        this.tableService = tableService;&#10;        this.reservationService = reservationService;&#10;        this.menu = menu;&#10;&#10;        String[] cols = {&quot;Table ID&quot;, &quot;Capacity&quot;, &quot;Status&quot;, &quot;Reservation ID&quot;, &quot;Customer&quot;};&#10;        tableModel = new DefaultTableModel(cols, 0) { @Override public boolean isCellEditable(int r, int c) { return false; } };&#10;        table = new JTable(tableModel);&#10;        // Make table columns resize to fit the viewport width so no horizontal scroll appears&#10;        table.setAutoResizeMode(JTable.AUTO_RESIZE_ALL_COLUMNS);&#10;        table.setFillsViewportHeight(true);&#10;        table.getTableHeader().setReorderingAllowed(false);&#10;&#10;        // Orders&#10;        ordersModel = new DefaultListModel&lt;&gt;();&#10;        ordersList = new JList&lt;&gt;(ordersModel);&#10;        ordersList.setVisibleRowCount(8);&#10;        btnAddOrder = new JButton(&quot;Add Order&quot;);&#10;        btnClearOrders = new JButton(&quot;Clear Orders&quot;);&#10;        btnEditOrders = new JButton(&quot;Edit Orders&quot;);&#10;        btnGetBill = new JButton(&quot;Get Bill&quot;);&#10;&#10;        JPanel top = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;        btnRefresh = new JButton(&quot;Refresh&quot;);&#10;        btnAssign = new JButton(&quot;Assign Reservation&quot;);&#10;        btnSeat = new JButton(&quot;Seat Reservation&quot;);&#10;        btnRelease = new JButton(&quot;Release Table&quot;);&#10;        // no icons for toolbar buttons (keep simple)&#10;         top.add(btnRefresh); top.add(btnAssign); top.add(btnSeat); top.add(btnRelease);&#10;&#10;        // Floor panel on the right shows a graphical view of tables&#10;        floorPanel = new JPanel();&#10;        // layout set dynamically in refreshTable() to create a grid that fits all table buttons&#10;        floorPanel.setLayout(new GridLayout(0, 1, 10, 10));&#10;&#10;        // Combine floor map and orders into right side&#10;        JPanel rightCombined = new JPanel(new BorderLayout());&#10;        rightCombined.add(new JScrollPane(floorPanel), BorderLayout.CENTER);&#10;&#10;        JPanel ordersPanel = new JPanel(new BorderLayout());&#10;        ordersPanel.setBorder(BorderFactory.createTitledBorder(&quot;Table Orders&quot;));&#10;        ordersPanel.add(new JScrollPane(ordersList), BorderLayout.CENTER);&#10;        JPanel ordersButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;        ordersButtons.add(btnAddOrder); ordersButtons.add(btnEditOrders); ordersButtons.add(btnClearOrders); ordersButtons.add(btnGetBill);&#10;        ordersPanel.add(ordersButtons, BorderLayout.SOUTH);&#10;&#10;        // Create scroll panes and avoid horizontal scroll on the main table by using auto-resize&#10;        JScrollPane leftScroll = new JScrollPane(table);&#10;        leftScroll.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);&#10;        JScrollPane rightScroll = new JScrollPane(rightCombined);&#10;&#10;        JSplitPane split = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT);&#10;        split.setLeftComponent(leftScroll);&#10;        split.setRightComponent(rightScroll);&#10;        split.setResizeWeight(0.6);&#10;&#10;        add(top, BorderLayout.NORTH);&#10;        add(split, BorderLayout.CENTER);&#10;&#10;        // Use small wrapper methods with ActionEvent to avoid IDE/static-analysis warnings about unused lambda parameters&#10;        btnRefresh.addActionListener(this::onRefreshAction);&#10;        btnAssign.addActionListener(this::onAssignAction);&#10;        btnSeat.addActionListener(this::onSeatAction);&#10;        btnRelease.addActionListener(this::onReleaseAction);&#10;        btnAddOrder.addActionListener(this::onAddOrderAction);&#10;        btnEditOrders.addActionListener(this::onEditOrdersAction);&#10;        btnClearOrders.addActionListener(this::onClearOrdersAction);&#10;        btnGetBill.addActionListener(this::onGetBillAction);&#10;&#10;        // Update orders when table selection changes&#10;        table.getSelectionModel().addListSelectionListener(e -&gt; {&#10;            if (!e.getValueIsAdjusting()) refreshOrdersForSelectedTable();&#10;        });&#10;&#10;        // Listen to order changes so UI updates when orders are added from other panels&#10;        tableService.addOrderListener(() -&gt; SwingUtilities.invokeLater(() -&gt; {&#10;            refreshTable();&#10;            refreshOrdersForSelectedTable();&#10;        }));&#10;&#10;        // Right-click on table rows to view order details&#10;        table.addMouseListener(new MouseAdapter() {&#10;            @Override public void mousePressed(MouseEvent e) { maybeShowPopup(e); }&#10;            @Override public void mouseReleased(MouseEvent e) { maybeShowPopup(e); }&#10;            private void maybeShowPopup(MouseEvent e) {&#10;                if (e.isPopupTrigger()) {&#10;                    int row = table.rowAtPoint(e.getPoint());&#10;                    if (row &gt;= 0) table.setRowSelectionInterval(row, row);&#10;                    Integer tableId = getSelectedTableId();&#10;                    if (tableId != null) {&#10;                        JPopupMenu pm = new JPopupMenu();&#10;                        JMenuItem mi = new JMenuItem(new AbstractAction(&quot;View Order Details&quot;) {&#10;                            @Override public void actionPerformed(ActionEvent e) { showOrderDetails(tableId); }&#10;                        });&#10;                        pm.add(mi);&#10;                        JMenuItem mi2 = new JMenuItem(new AbstractAction(&quot;Edit Orders&quot;) {&#10;                            @Override public void actionPerformed(ActionEvent e) { editOrdersDialog(tableId); }&#10;                        });&#10;                        pm.add(mi2);&#10;                         pm.show(table, e.getX(), e.getY());&#10;                     }&#10;                 }&#10;             }&#10;         });&#10;&#10;        refreshTable();&#10;    }&#10;&#10;    private Integer getSelectedTableId() {&#10;        int row = table.getSelectedRow();&#10;        if (row &lt; 0) return null;&#10;        Object idObj = tableModel.getValueAt(row, 0);&#10;        try { return Integer.parseInt(String.valueOf(idObj)); } catch (Exception ex) { return null; }&#10;    }&#10;&#10;    private void onAssign() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        // Show a selector of reservations that are not cancelled and not already assigned&#10;        java.util.List&lt;Reservation&gt; candidates = reservationService.getAll().stream()&#10;                .filter(r -&gt; r.getStatus() != org.models.ReservationStatus.CANCELLED &amp;&amp; r.getTableId() == null)&#10;                .toList();&#10;        if (candidates.isEmpty()) {&#10;            JOptionPane.showMessageDialog(this, &quot;No available reservations to assign.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;            return;&#10;        }&#10;        JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;();&#10;        Map&lt;String, Integer&gt; keyToId = new HashMap&lt;&gt;();&#10;        for (Reservation r : candidates) {&#10;            String key = r.getId() + &quot; - &quot; + r.getCustomerName() + &quot; (&quot; + r.getGuests() + &quot;)&quot;;&#10;            combo.addItem(key);&#10;            keyToId.put(key, r.getId());&#10;        }&#10;        int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select reservation to assign&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;        if (res != JOptionPane.OK_OPTION) return;&#10;        String chosen = (String) combo.getSelectedItem();&#10;        if (chosen == null) return;&#10;        int resId = keyToId.get(chosen);&#10;        try {&#10;            boolean ok = reservationService.assignTableToReservation(resId, tableId);&#10;            if (ok) {&#10;                JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; assigned to reservation &quot; + resId);&#10;                refreshTable();&#10;            } else {&#10;                JOptionPane.showMessageDialog(this, &quot;Failed to assign table. Ensure table is free and reservation exists.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        } catch (ReservationNotFoundException rnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Reservation not found: &quot; + rnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // New: seat a reservation for the selected table (mark it occupied)&#10;    private void onSeat() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        Mesa m = tableService.getMesas().get(tableId);&#10;        if (m == null) { JOptionPane.showMessageDialog(this, &quot;Table not found.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;&#10;        var optRes = reservationService.findByTableId(tableId);&#10;        if (optRes.isPresent()) {&#10;            Reservation r = optRes.get();&#10;            int res = JOptionPane.showConfirmDialog(this,&#10;                    &quot;Seat reservation &quot; + r.getId() + &quot; for &quot; + r.getCustomerName() + &quot; now?&quot;,&#10;                    &quot;Seat Reservation&quot;,&#10;                    JOptionPane.YES_NO_OPTION);&#10;            if (res == JOptionPane.YES_OPTION) {&#10;                boolean ok = reservationService.seatReservation(r.getId());&#10;                if (ok) {&#10;                    JOptionPane.showMessageDialog(this, &quot;Reservation seated; table &quot; + m.getId() + &quot; is now occupied.&quot;);&#10;                    // Prompt for orders immediately after seating from floor map&#10;                   promptAndAddOrders(m.getId());&#10;                   refreshTable();&#10;                } else {&#10;                    JOptionPane.showMessageDialog(this, &quot;Failed to seat reservation.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                }&#10;            }&#10;        } else {&#10;            // No reservation assigned to this table — allow seating as a walk-in (mark occupied)&#10;            if (m.getEstado() == org.models.TableStatus.OCUPADA) {&#10;                JOptionPane.showMessageDialog(this, &quot;Table is already occupied.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                return;&#10;            }&#10;            int res = JOptionPane.showConfirmDialog(this,&#10;                    &quot;No reservation assigned. Mark table &quot; + m.getId() + &quot; as occupied for a walk-in?&quot;,&#10;                    &quot;Seat Walk-in&quot;,&#10;                    JOptionPane.YES_NO_OPTION);&#10;            if (res == JOptionPane.YES_OPTION) {&#10;                try {&#10;                    boolean ok = tableService.occupyTable(m.getId());&#10;                    if (ok) {&#10;                        // Prompt for orders for the walk-in immediately&#10;                        promptAndAddOrders(m.getId());&#10;                        refreshTable();&#10;                    } else {&#10;                        JOptionPane.showMessageDialog(this, &quot;Failed to mark table as occupied.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                    }&#10;                } catch (org.exceptions.TableNotFoundException tnfe) {&#10;                    JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private void onRelease() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        try {&#10;            boolean ok = tableService.releaseTable(tableId);&#10;            if (ok) {&#10;                // also clear reservation assignment if any&#10;                var opt = reservationService.findByTableId(tableId);&#10;                opt.ifPresent(r -&gt; r.setTableId(null));&#10;                // cancel any orders for this table (mark cancelled and cancel linked production jobs)&#10;                try {&#10;                    tableService.cancelOrdersForTable(tableId);&#10;                } catch (Exception ignored) {}&#10;                JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; released and orders cancelled.&quot;);&#10;                refreshTable();&#10;            } else {&#10;                JOptionPane.showMessageDialog(this, &quot;Failed to release table.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // Dialog to create a new reservation and assign to a table&#10;    private void createAndAssignReservation(int tableId, int capacidad) {&#10;        JPanel panel = new JPanel(new GridLayout(0, 2));&#10;        JTextField customerField = new JTextField();&#10;        JSpinner guestsSpinner = new JSpinner(new SpinnerNumberModel(1, 1, capacidad, 1));&#10;        JSpinner dateSpinner = new JSpinner(new SpinnerDateModel());&#10;        panel.add(new JLabel(&quot;Customer Name:&quot;)); panel.add(customerField);&#10;        panel.add(new JLabel(&quot;Guests:&quot;)); panel.add(guestsSpinner);&#10;        panel.add(new JLabel(&quot;Date &amp; Time:&quot;)); panel.add(dateSpinner);&#10;        int res = JOptionPane.showConfirmDialog(this, panel, &quot;New Reservation&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;        if (res != JOptionPane.OK_OPTION) return;&#10;        String customer = customerField.getText().trim();&#10;        int guests = (Integer) guestsSpinner.getValue();&#10;        java.util.Date date = (java.util.Date) dateSpinner.getValue();&#10;        java.time.LocalDateTime when = java.time.LocalDateTime.ofInstant(date.toInstant(), java.time.ZoneId.systemDefault());&#10;        if (customer.isEmpty()) {&#10;            JOptionPane.showMessageDialog(this, &quot;Customer name required.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            return;&#10;        }&#10;        // Create reservation&#10;        Reservation r = reservationService.createReservation(customer, guests, when);&#10;        r.setTableId(tableId);&#10;        r.setStatus(org.models.ReservationStatus.CONFIRMED);&#10;        try {&#10;            tableService.assignTable(tableId);&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found when assigning: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            return;&#10;        }&#10;        JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; reserved for &quot; + customer);&#10;        refreshTable();&#10;    }&#10;&#10;    private void onAddOrder() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table if none selected&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;();&#10;            java.util.Map&lt;String, Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) {&#10;                String key = mm.getId() + &quot; - &quot; + mm.getEstado();&#10;                combo.addItem(key);&#10;                keyToId.put(key, mm.getId());&#10;            }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to add order&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return;&#10;            String chosen = (String) combo.getSelectedItem();&#10;            if (chosen == null) return;&#10;            tableId = keyToId.get(chosen);&#10;        }&#10;        promptAndAddOrders(tableId);&#10;    }&#10;&#10;    private void onClearOrders() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        int res = JOptionPane.showConfirmDialog(this, &quot;Clear all orders for table &quot; + tableId + &quot;?&quot;, &quot;Confirm&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.WARNING_MESSAGE);&#10;        if (res != JOptionPane.OK_OPTION) return;&#10;        try {&#10;            tableService.clearOrders(tableId);&#10;            refreshOrdersForSelectedTable();&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    private void onGetBill() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; orders = tableService.getOrders(tableId);&#10;&#10;            // Determine customer name: prefer reservation's customer; if none and table is occupied, ask for it&#10;            String customerName = null;&#10;            var optRes = reservationService.findByTableId(tableId);&#10;            if (optRes.isPresent()) {&#10;                customerName = optRes.get().getCustomerName();&#10;            } else {&#10;                // no reservation assigned — if table is actually occupied, ask for customer name before billing&#10;                Mesa m = tableService.getMesas().get(tableId);&#10;                if (m != null &amp;&amp; m.getEstado() == org.models.TableStatus.OCUPADA) {&#10;                    String input = (String) JOptionPane.showInputDialog(this,&#10;                            &quot;Enter customer name for table &quot; + tableId + &quot;:&quot;,&#10;                            &quot;Customer required&quot;,&#10;                            JOptionPane.PLAIN_MESSAGE,&#10;                            null,&#10;                            null,&#10;                            &quot;&quot;);&#10;                    if (input == null) return; // user cancelled&#10;                    input = input.trim();&#10;                    if (input.isEmpty()) {&#10;                        JOptionPane.showMessageDialog(this, &quot;Customer name required to generate the bill.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                        return;&#10;                    }&#10;                    customerName = input;&#10;                }&#10;            }&#10;&#10;            Factura factura = new Factura(tableId, orders, menu);&#10;            StringBuilder fullText = new StringBuilder();&#10;            if (customerName != null &amp;&amp; !customerName.isEmpty()) {&#10;                fullText.append(&quot;Customer: &quot;).append(customerName).append('\n');&#10;            }&#10;            // StringBuilder.append(Object) will call toString() internally&#10;            fullText.append(factura);&#10;&#10;            JTextArea ta = new JTextArea(fullText.toString());&#10;            ta.setEditable(false);&#10;            ta.setRows(Math.min(20, factura.getItems().size() + 6));&#10;            ta.setColumns(50);&#10;            int res = JOptionPane.showOptionDialog(this, new JScrollPane(ta), &quot;Factura - Table &quot; + tableId,&#10;                    JOptionPane.YES_NO_OPTION, JOptionPane.PLAIN_MESSAGE, null, new String[] {&quot;Close&quot;,&quot;Settle &amp; Clear&quot;}, &quot;Close&quot;);&#10;            if (res == JOptionPane.NO_OPTION) {&#10;                // Settle: clear orders and release table&#10;                try {&#10;                    // Clear orders&#10;                    tableService.clearOrders(tableId);&#10;                    // release the mesa and remove reservation assignment if any&#10;                    try {&#10;                        boolean ok = tableService.releaseTable(tableId);&#10;                        if (ok) {&#10;                            var opt = reservationService.findByTableId(tableId);&#10;                            opt.ifPresent(r -&gt; r.setTableId(null));&#10;                        }&#10;                    } catch (TableNotFoundException ignored) {}&#10;                } catch (Exception ignored) {}&#10;                refreshTable();&#10;            }&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    private void refreshOrdersForSelectedTable() {&#10;        ordersModel.clear();&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) return;&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; list = new java.util.ArrayList&lt;&gt;(tableService.getOrders(tableId));&#10;            list.sort((a,b) -&gt; {&#10;                Long ta = a.getEstimatedMinutes();&#10;                Long tb = b.getEstimatedMinutes();&#10;                if (ta == null &amp;&amp; tb == null) return 0;&#10;                if (ta == null) return 1;&#10;                if (tb == null) return -1;&#10;                return ta.compareTo(tb);&#10;            });&#10;            for (OrderItem oi : list) ordersModel.addElement(oi);&#10;        } catch (TableNotFoundException tnfe) {&#10;            // ignore&#10;        }&#10;    }&#10;&#10;    private void showOrderDetails(int tableId) {&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; orders = tableService.getOrders(tableId);&#10;            if (orders.isEmpty()) {&#10;                JOptionPane.showMessageDialog(this, &quot;No orders for table &quot; + tableId, &quot;Orders&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                return;&#10;            }&#10;            StringBuilder sb = new StringBuilder();&#10;            sb.append(&quot;Orders for table &quot;).append(tableId).append(&quot;\n\n&quot;);&#10;            for (OrderItem oi : orders) sb.append(oi.toString()).append(&quot;\n&quot;);&#10;            JTextArea ta = new JTextArea(sb.toString());&#10;            ta.setEditable(false);&#10;            ta.setRows(Math.min(orders.size()+2, 15));&#10;            ta.setColumns(40);&#10;            JOptionPane.showMessageDialog(this, new JScrollPane(ta), &quot;Order Details&quot;, JOptionPane.PLAIN_MESSAGE);&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    public void refreshTable() {&#10;        tableModel.setRowCount(0);&#10;        tableButtons.clear();&#10;        floorPanel.removeAll();&#10;        for (Map.Entry&lt;Integer, Mesa&gt; e : tableService.getMesas().entrySet()) {&#10;            Mesa m = e.getValue();&#10;            String reservationId = &quot;-&quot;;&#10;            String customer = &quot;-&quot;;&#10;            var opt = reservationService.findByTableId(m.getId());&#10;            if (opt.isPresent()) {&#10;                Reservation r = opt.get();&#10;                reservationId = String.valueOf(r.getId());&#10;                customer = r.getCustomerName();&#10;            }&#10;            Object[] row = new Object[] { m.getId(), m.getCapacidad(), m.getEstado(), reservationId, customer };&#10;            tableModel.addRow(row);&#10;&#10;            // Create a visual button for the floor map&#10;            JButton tb = new JButton(&quot;Table &quot; + m.getId());&#10;            // let GridLayout size buttons evenly; keep a comfortable margin and tooltip for capacity&#10;            tb.setMargin(new Insets(6,6,6,6));&#10;            tb.setToolTipText(&quot;Capacity: &quot; + m.getCapacidad());&#10;            tb.setVerticalTextPosition(SwingConstants.CENTER);&#10;            tb.setHorizontalTextPosition(SwingConstants.CENTER);&#10;             // color by status&#10;             switch (m.getEstado()) {&#10;                 case LIBRE -&gt; tb.setBackground(new Color(200,255,200));&#10;                 case RESERVADA -&gt; tb.setBackground(new Color(255,230,150));&#10;                 case OCUPADA -&gt; tb.setBackground(new Color(255,150,150));&#10;                 default -&gt; tb.setBackground(UIManager.getColor(&quot;Button.background&quot;));&#10;             }&#10;             // select table in table when clicked&#10;             tb.addActionListener(ae -&gt; {&#10;                 // select row in table&#10;                 for (int rowIdx = 0; rowIdx &lt; tableModel.getRowCount(); rowIdx++) {&#10;                     if (String.valueOf(tableModel.getValueAt(rowIdx,0)).equals(String.valueOf(m.getId()))) {&#10;                         table.setRowSelectionInterval(rowIdx, rowIdx);&#10;                         table.scrollRectToVisible(table.getCellRect(rowIdx, 0, true));&#10;                         break;&#10;                     }&#10;                 }&#10;                 // refresh orders view for this table&#10;                 refreshOrdersForSelectedTable();&#10;                 // show unified actions dialog for this table (view/edit/add orders + status actions)&#10;                 showTableActions(m);&#10;             });&#10;            floorPanel.add(tb);&#10;            tableButtons.put(m.getId(), tb);&#10;        }&#10;        // adapt floorPanel to a square-ish grid based on number of tables&#10;        int n = tableButtons.size();&#10;        if (n &gt; 0) {&#10;            int cols = (int) Math.ceil(Math.sqrt(n));&#10;            cols = Math.max(1, Math.min(cols, 6)); // limit columns for usability&#10;            floorPanel.setLayout(new GridLayout(0, cols, 10, 10));&#10;        } else {&#10;            floorPanel.setLayout(new GridLayout(0, 1, 10, 10));&#10;        }&#10;        floorPanel.revalidate();&#10;        floorPanel.repaint();&#10;&#10;        // attempt to refresh orders for currently selected row&#10;        refreshOrdersForSelectedTable();&#10;    }&#10;&#10;    // --- Action wrappers to avoid unused-lambda warnings from static analysis ---&#10;    private void onRefreshAction(ActionEvent e) { refreshTable(); }&#10;    private void onAssignAction(ActionEvent e) { onAssign(); }&#10;    private void onSeatAction(ActionEvent e) { onSeat(); }&#10;    private void onReleaseAction(ActionEvent e) { onRelease(); }&#10;    private void onAddOrderAction(ActionEvent e) {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table if none selected&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;();&#10;            java.util.Map&lt;String, Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) {&#10;                String key = mm.getId() + &quot; - &quot; + mm.getEstado();&#10;                combo.addItem(key);&#10;                keyToId.put(key, mm.getId());&#10;            }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to add order&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return;&#10;            String chosen = (String) combo.getSelectedItem();&#10;            if (chosen == null) return;&#10;            tableId = keyToId.get(chosen);&#10;        }&#10;        promptAndAddOrders(tableId);&#10;    }&#10;    private void onClearOrdersAction(ActionEvent e) { onClearOrders(); }&#10;    private void onGetBillAction(ActionEvent e) { onGetBill(); }&#10;&#10;    // Nicer dialog to add multiple order items to the given table&#10;    private void promptAndAddOrders(int tableId) {&#10;        JDialog dlg = new JDialog(SwingUtilities.getWindowAncestor(this), &quot;Add Orders - Table &quot; + tableId, Dialog.ModalityType.APPLICATION_MODAL);&#10;        dlg.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);&#10;        dlg.setLayout(new BorderLayout(10,10));&#10;&#10;        // Left: menu selection (or manual entry if no menu)&#10;        JPanel left = new JPanel(new BorderLayout(5,5));&#10;        left.setBorder(BorderFactory.createTitledBorder(&quot;Menu Items&quot;));&#10;        DefaultListModel&lt;String&gt; menuModel = new DefaultListModel&lt;&gt;();&#10;        java.util.List&lt;org.models.Recipe&gt; recipes = new java.util.ArrayList&lt;&gt;();&#10;        if (menu != null) {&#10;            for (org.models.Recipe r : menu.getAll().values()) { menuModel.addElement(r.getNombre()); recipes.add(r); }&#10;        }&#10;        JList&lt;String&gt; menuList = new JList&lt;&gt;(menuModel);&#10;        menuList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);&#10;        left.add(new JScrollPane(menuList), BorderLayout.CENTER);&#10;&#10;        JPanel manual = new JPanel(new GridLayout(0,1,4,4));&#10;        JTextField manualName = new JTextField();&#10;        JSpinner manualQty = new JSpinner(new SpinnerNumberModel(1,1,100,1));&#10;        manual.add(new JLabel(&quot;Manual name (if not using menu):&quot;)); manual.add(manualName);&#10;        manual.add(new JLabel(&quot;Quantity:&quot;)); manual.add(manualQty);&#10;        left.add(manual, BorderLayout.SOUTH);&#10;&#10;        // Center: add controls&#10;        JPanel center = new JPanel(new GridLayout(0,1,4,4));&#10;        JButton btnAdd = new JButton(&quot;Add to preview&quot;);&#10;        center.add(btnAdd);&#10;&#10;        // Right: preview of items to be added&#10;        DefaultListModel&lt;OrderItem&gt; previewModel = new DefaultListModel&lt;&gt;();&#10;        JList&lt;OrderItem&gt; previewList = new JList&lt;&gt;(previewModel);&#10;        previewList.setVisibleRowCount(8);&#10;        JPanel right = new JPanel(new BorderLayout(5,5));&#10;        right.setBorder(BorderFactory.createTitledBorder(&quot;Preview (will be added to table)&quot;));&#10;        right.add(new JScrollPane(previewList), BorderLayout.CENTER);&#10;        JPanel previewButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;        JButton btnRemove = new JButton(&quot;Remove&quot;);&#10;        previewButtons.add(btnRemove);&#10;        right.add(previewButtons, BorderLayout.SOUTH);&#10;&#10;        // Bottom: confirm/cancel&#10;        JPanel bottom = new JPanel(new FlowLayout(FlowLayout.RIGHT));&#10;        JButton btnConfirm = new JButton(&quot;Confirm and Add&quot;);&#10;        JButton btnCancel = new JButton(&quot;Cancel&quot;);&#10;        bottom.add(btnCancel); bottom.add(btnConfirm);&#10;&#10;        // Wire actions&#10;        btnAdd.addActionListener(ae -&gt; {&#10;            String selected = menuList.getSelectedValue();&#10;            int qty = (Integer) manualQty.getValue();&#10;            if (selected != null &amp;&amp; !selected.isEmpty()) {&#10;                // find recipe id&#10;                Integer rid = null;&#10;                for (org.models.Recipe r : recipes) if (r.getNombre().equals(selected)) { rid = r.getId(); break; }&#10;                previewModel.addElement(new OrderItem(selected, qty, rid));&#10;            } else {&#10;                String name = manualName.getText().trim();&#10;                if (name.isEmpty()) { JOptionPane.showMessageDialog(dlg, &quot;Enter a name or select a menu item.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;                previewModel.addElement(new OrderItem(name, qty, null));&#10;            }&#10;        });&#10;&#10;        btnRemove.addActionListener(ae -&gt; {&#10;            int idx = previewList.getSelectedIndex();&#10;            if (idx &gt;= 0) previewModel.remove(idx);&#10;        });&#10;&#10;        btnCancel.addActionListener(ae -&gt; dlg.dispose());&#10;&#10;        btnConfirm.addActionListener(ae -&gt; {&#10;            if (previewModel.isEmpty()) { dlg.dispose(); return; }&#10;            try {&#10;                for (int i=0;i&lt;previewModel.size();i++) {&#10;                    OrderItem oi = previewModel.get(i);&#10;                    tableService.addOrder(tableId, oi);&#10;                }&#10;                dlg.dispose();&#10;                JOptionPane.showMessageDialog(this, &quot;Added &quot; + previewModel.size() + &quot; order(s) to table &quot; + tableId + &quot;.&quot;);&#10;                refreshOrdersForSelectedTable();&#10;            } catch (TableNotFoundException tnfe) {&#10;                JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        });&#10;&#10;        // Layout main dialog&#10;        JPanel mid = new JPanel(new BorderLayout(10,10));&#10;        mid.add(left, BorderLayout.WEST);&#10;        mid.add(center, BorderLayout.CENTER);&#10;        mid.add(right, BorderLayout.EAST);&#10;        dlg.add(mid, BorderLayout.CENTER);&#10;        dlg.add(bottom, BorderLayout.SOUTH);&#10;        dlg.pack();&#10;        dlg.setLocationRelativeTo(this);&#10;        dlg.setVisible(true);&#10;    }&#10;&#10;    // Open an edit dialog prepopulated with current orders; on confirm replace table's orders with preview&#10;    private void editOrdersDialog(int tableId) {&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; existing = new java.util.ArrayList&lt;&gt;(tableService.getOrders(tableId));&#10;&#10;            JDialog dlg = new JDialog(SwingUtilities.getWindowAncestor(this), &quot;Edit Orders - Table &quot; + tableId, Dialog.ModalityType.APPLICATION_MODAL);&#10;            dlg.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);&#10;            dlg.setLayout(new BorderLayout(10,10));&#10;&#10;            // reuse prompt UI parts: menu list and manual entry&#10;            DefaultListModel&lt;String&gt; menuModel = new DefaultListModel&lt;&gt;();&#10;            java.util.List&lt;org.models.Recipe&gt; recipes = new java.util.ArrayList&lt;&gt;();&#10;            if (menu != null) for (org.models.Recipe r : menu.getAll().values()) { menuModel.addElement(r.getNombre()); recipes.add(r); }&#10;            JList&lt;String&gt; menuList = new JList&lt;&gt;(menuModel);&#10;            menuList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);&#10;&#10;            JPanel left = new JPanel(new BorderLayout(5,5));&#10;            left.setBorder(BorderFactory.createTitledBorder(&quot;Menu Items&quot;));&#10;            left.add(new JScrollPane(menuList), BorderLayout.CENTER);&#10;            JPanel manual = new JPanel(new GridLayout(0,1,4,4));&#10;            JTextField manualName = new JTextField();&#10;            JSpinner manualQty = new JSpinner(new SpinnerNumberModel(1,1,100,1));&#10;            manual.add(new JLabel(&quot;Manual name (if not using menu):&quot;)); manual.add(manualName);&#10;            manual.add(new JLabel(&quot;Quantity:&quot;)); manual.add(manualQty);&#10;            left.add(manual, BorderLayout.SOUTH);&#10;&#10;            JPanel center = new JPanel(new GridLayout(0,1,4,4));&#10;            JButton btnAdd = new JButton(&quot;Add to preview&quot;);&#10;            center.add(btnAdd);&#10;&#10;            DefaultListModel&lt;OrderItem&gt; previewModel = new DefaultListModel&lt;&gt;();&#10;            for (OrderItem oi : existing) previewModel.addElement(oi);&#10;            JList&lt;OrderItem&gt; previewList = new JList&lt;&gt;(previewModel);&#10;            JPanel right = new JPanel(new BorderLayout(5,5));&#10;            right.setBorder(BorderFactory.createTitledBorder(&quot;Preview (will replace table orders)&quot;));&#10;            right.add(new JScrollPane(previewList), BorderLayout.CENTER);&#10;            JPanel previewButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;            JButton btnRemove = new JButton(&quot;Remove&quot;); previewButtons.add(btnRemove);&#10;            right.add(previewButtons, BorderLayout.SOUTH);&#10;&#10;            JPanel bottom = new JPanel(new FlowLayout(FlowLayout.RIGHT));&#10;            JButton btnConfirm = new JButton(&quot;Confirm Changes&quot;); JButton btnCancel = new JButton(&quot;Cancel&quot;);&#10;            bottom.add(btnCancel); bottom.add(btnConfirm);&#10;&#10;            btnAdd.addActionListener(ae -&gt; {&#10;                String selected = menuList.getSelectedValue();&#10;                int qty = (Integer) manualQty.getValue();&#10;                if (selected != null &amp;&amp; !selected.isEmpty()) {&#10;                    Integer rid = null; for (org.models.Recipe r : recipes) if (r.getNombre().equals(selected)) { rid = r.getId(); break; }&#10;                    previewModel.addElement(new OrderItem(selected, qty, rid));&#10;                } else {&#10;                    String name = manualName.getText().trim(); if (name.isEmpty()) { JOptionPane.showMessageDialog(dlg, &quot;Enter a name or select a menu item.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;                    previewModel.addElement(new OrderItem(name, qty, null));&#10;                }&#10;            });&#10;            btnRemove.addActionListener(ae -&gt; { int idx = previewList.getSelectedIndex(); if (idx &gt;= 0) previewModel.remove(idx); });&#10;            btnCancel.addActionListener(ae -&gt; dlg.dispose());&#10;&#10;            btnConfirm.addActionListener(ae -&gt; {&#10;                try {&#10;                    // mark existing orders CANCELLED and cancel their production jobs so kitchen updates&#10;                    tableService.cancelOrdersForTable(tableId);&#10;                    // then add the new preview items (these will create new production jobs as needed)&#10;                    for (int i=0;i&lt;previewModel.size();i++) tableService.addOrder(tableId, previewModel.get(i));&#10;                    dlg.dispose();&#10;                    JOptionPane.showMessageDialog(this, &quot;Updated orders for table &quot; + tableId);&#10;                    refreshOrdersForSelectedTable();&#10;                } catch (TableNotFoundException tnfe) {&#10;                    JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                }&#10;            });&#10;&#10;            JPanel mid = new JPanel(new BorderLayout(10,10)); mid.add(left, BorderLayout.WEST); mid.add(center, BorderLayout.CENTER); mid.add(right, BorderLayout.EAST);&#10;            dlg.add(mid, BorderLayout.CENTER); dlg.add(bottom, BorderLayout.SOUTH);&#10;            dlg.pack(); dlg.setLocationRelativeTo(this); dlg.setVisible(true);&#10;&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // Action wrapper for Edit Orders button&#10;    private void onEditOrdersAction(ActionEvent e) {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;(); java.util.Map&lt;String,Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) { String key = mm.getId() + &quot; - &quot; + mm.getEstado(); combo.addItem(key); keyToId.put(key, mm.getId()); }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to edit orders&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return; String chosen = (String) combo.getSelectedItem(); if (chosen == null) return; tableId = keyToId.get(chosen);&#10;        }&#10;        editOrdersDialog(tableId);&#10;    }&#10;&#10;    // Show a unified dialog with table actions: view orders, edit orders, add orders, and status specific actions&#10;    private void showTableActions(Mesa m) {&#10;        java.util.List&lt;String&gt; opts = new java.util.ArrayList&lt;&gt;();&#10;        opts.add(&quot;View Orders&quot;);&#10;        opts.add(&quot;Edit Orders&quot;);&#10;        opts.add(&quot;Add Orders&quot;);&#10;        // status-specific&#10;        switch (m.getEstado()) {&#10;            case LIBRE -&gt; {&#10;                opts.add(&quot;Create Reservation&quot;);&#10;                opts.add(&quot;Mark Occupied&quot;);&#10;            }&#10;            case RESERVADA -&gt; {&#10;                opts.add(&quot;Seat Reservation&quot;);&#10;                opts.add(&quot;Mark Occupied&quot;);&#10;            }&#10;            case OCUPADA -&gt; {&#10;                opts.add(&quot;Release Table&quot;);&#10;            }&#10;            default -&gt; {}&#10;        }&#10;        opts.add(&quot;Cancel&quot;);&#10;&#10;        String[] options = opts.toArray(new String[0]);&#10;        int choice = JOptionPane.showOptionDialog(this,&#10;                &quot;Table &quot; + m.getId() + &quot; - choose action:&quot;,&#10;                &quot;Table Actions&quot;,&#10;                JOptionPane.DEFAULT_OPTION,&#10;                JOptionPane.PLAIN_MESSAGE,&#10;                null,&#10;                options,&#10;                options[0]);&#10;&#10;        if (choice &lt; 0 || choice &gt;= options.length) return;&#10;        String sel = options[choice];&#10;        switch (sel) {&#10;            case &quot;View Orders&quot; -&gt; showOrderDetails(m.getId());&#10;            case &quot;Edit Orders&quot; -&gt; editOrdersDialog(m.getId());&#10;            case &quot;Add Orders&quot; -&gt; promptAndAddOrders(m.getId());&#10;            case &quot;Create Reservation&quot; -&gt; createAndAssignReservation(m.getId(), m.getCapacidad());&#10;            case &quot;Mark Occupied&quot; -&gt; {&#10;                try {&#10;                    boolean ok = tableService.occupyTable(m.getId());&#10;                    if (ok) { promptAndAddOrders(m.getId()); refreshTable(); }&#10;                } catch (TableNotFoundException tnfe) { JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); }&#10;            }&#10;            case &quot;Seat Reservation&quot; -&gt; {&#10;                var opt = reservationService.findByTableId(m.getId());&#10;                if (opt.isPresent()) {&#10;                    Reservation r = opt.get();&#10;                    int res = JOptionPane.showConfirmDialog(this, &quot;Seat reservation &quot; + r.getId() + &quot; for &quot; + r.getCustomerName() + &quot; now?&quot;, &quot;Seat Reservation&quot;, JOptionPane.YES_NO_OPTION);&#10;                    if (res == JOptionPane.YES_OPTION) {&#10;                        boolean ok = reservationService.seatReservation(r.getId());&#10;                        if (ok) { JOptionPane.showMessageDialog(this, &quot;Reservation seated; table &quot; + m.getId() + &quot; is now occupied.&quot;); promptAndAddOrders(m.getId()); refreshTable(); }&#10;                        else JOptionPane.showMessageDialog(this, &quot;Failed to seat reservation.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                    }&#10;                } else {&#10;                    JOptionPane.showMessageDialog(this, &quot;No reservation found for this table.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                }&#10;            }&#10;            case &quot;Release Table&quot; -&gt; {&#10;                int res = JOptionPane.showConfirmDialog(this, &quot;Release table &quot; + m.getId() + &quot; now?&quot;, &quot;Release Table&quot;, JOptionPane.YES_NO_OPTION);&#10;                if (res == JOptionPane.YES_OPTION) onRelease();&#10;            }&#10;            default -&gt; {}&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.gui;&#10;&#10;import org.models.Mesa;&#10;import org.models.Menu;&#10;import org.models.Reservation;&#10;import org.models.ReservationService;&#10;import org.models.TableService;&#10;import org.models.OrderItem;&#10;import org.models.Recipe;&#10;import org.models.Factura;&#10;import org.exceptions.TableNotFoundException;&#10;import org.exceptions.ReservationNotFoundException;&#10;&#10;import javax.swing.*;&#10;import javax.swing.table.DefaultTableModel;&#10;import java.awt.*;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import javax.swing.SwingUtilities;&#10;import java.awt.event.MouseAdapter;&#10;import java.awt.event.MouseEvent;&#10;import java.awt.event.ActionEvent;&#10;import javax.swing.AbstractAction;&#10;&#10;public class TablesPanel extends JPanel {&#10;    private final TableService tableService;&#10;    private final ReservationService reservationService;&#10;    private final Menu menu;&#10;     private final DefaultTableModel tableModel;&#10;     private final JTable table;&#10;     private final JButton btnRefresh;&#10;     private final JButton btnAssign;&#10;     private final JButton btnSeat;&#10;     private final JButton btnRelease;&#10;&#10;    // Floor map panel and buttons per table&#10;    private final JPanel floorPanel;&#10;    private final Map&lt;Integer, JButton&gt; tableButtons = new HashMap&lt;&gt;();&#10;&#10;    // Orders UI&#10;    private final DefaultListModel&lt;OrderItem&gt; ordersModel;&#10;    private final JList&lt;OrderItem&gt; ordersList;&#10;    private final JButton btnAddOrder;&#10;    private final JButton btnClearOrders;&#10;    private final JButton btnEditOrders;&#10;    private final JButton btnGetBill;&#10;    private final JButton btnBillAndClose;&#10;    private final JButton btnViewOrders;&#10;&#10;    public TablesPanel(TableService tableService, ReservationService reservationService, Menu menu) {&#10;        super(new BorderLayout());&#10;        this.tableService = tableService;&#10;        this.reservationService = reservationService;&#10;        this.menu = menu;&#10;&#10;        String[] cols = {&quot;Table ID&quot;, &quot;Capacity&quot;, &quot;Status&quot;, &quot;Reservation ID&quot;, &quot;Customer&quot;};&#10;        tableModel = new DefaultTableModel(cols, 0) { @Override public boolean isCellEditable(int r, int c) { return false; } };&#10;        table = new JTable(tableModel);&#10;        // Make table columns resize to fit the viewport width so no horizontal scroll appears&#10;        table.setAutoResizeMode(JTable.AUTO_RESIZE_ALL_COLUMNS);&#10;        table.setFillsViewportHeight(true);&#10;        table.getTableHeader().setReorderingAllowed(false);&#10;&#10;        // Orders&#10;        ordersModel = new DefaultListModel&lt;&gt;();&#10;        ordersList = new JList&lt;&gt;(ordersModel);&#10;        ordersList.setVisibleRowCount(8);&#10;        btnAddOrder = new JButton(&quot;Add Order&quot;);&#10;        btnClearOrders = new JButton(&quot;Clear Orders&quot;);&#10;        btnEditOrders = new JButton(&quot;Edit Orders&quot;);&#10;        btnGetBill = new JButton(&quot;Get Bill&quot;);&#10;        btnBillAndClose = new JButton(&quot;Bill &amp; Close&quot;);&#10;        btnViewOrders = new JButton(&quot;View Orders&quot;);&#10;&#10;        JPanel top = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;        btnRefresh = new JButton(&quot;Refresh&quot;);&#10;        btnAssign = new JButton(&quot;Assign Reservation&quot;);&#10;        btnSeat = new JButton(&quot;Seat Reservation&quot;);&#10;        btnRelease = new JButton(&quot;Release Table&quot;);&#10;        // no icons for toolbar buttons (keep simple)&#10;         top.add(btnRefresh); top.add(btnAssign); top.add(btnSeat); top.add(btnRelease);&#10;&#10;        // Floor panel on the right shows a graphical view of tables&#10;        floorPanel = new JPanel();&#10;        // layout set dynamically in refreshTable() to create a grid that fits all table buttons&#10;        floorPanel.setLayout(new GridLayout(0, 1, 10, 10));&#10;&#10;        // Combine floor map and orders into right side&#10;        JPanel rightCombined = new JPanel(new BorderLayout());&#10;        rightCombined.add(new JScrollPane(floorPanel), BorderLayout.CENTER);&#10;&#10;        JPanel ordersPanel = new JPanel(new BorderLayout());&#10;        ordersPanel.setBorder(BorderFactory.createTitledBorder(&quot;Table Orders&quot;));&#10;        ordersPanel.add(new JScrollPane(ordersList), BorderLayout.CENTER);&#10;        JPanel ordersButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;        // Simplified UI: expose a single &quot;View Orders&quot; entry and a quick &quot;Bill &amp; Close&quot; action&#10;        ordersButtons.add(btnViewOrders);&#10;        ordersButtons.add(btnBillAndClose);&#10;        ordersPanel.add(ordersButtons, BorderLayout.SOUTH);&#10;&#10;        // Create scroll panes and avoid horizontal scroll on the main table by using auto-resize&#10;        JScrollPane leftScroll = new JScrollPane(table);&#10;        leftScroll.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);&#10;        JScrollPane rightScroll = new JScrollPane(rightCombined);&#10;&#10;        JSplitPane split = new JSplitPane(JSplitPane.HORIZONTAL_SPLIT);&#10;        split.setLeftComponent(leftScroll);&#10;        split.setRightComponent(rightScroll);&#10;        split.setResizeWeight(0.6);&#10;&#10;        add(top, BorderLayout.NORTH);&#10;        add(split, BorderLayout.CENTER);&#10;&#10;        // Use small wrapper methods with ActionEvent to avoid IDE/static-analysis warnings about unused lambda parameters&#10;        btnRefresh.addActionListener(this::onRefreshAction);&#10;        btnAssign.addActionListener(this::onAssignAction);&#10;        btnSeat.addActionListener(this::onSeatAction);&#10;        btnRelease.addActionListener(this::onReleaseAction);&#10;        btnAddOrder.addActionListener(this::onAddOrderAction);&#10;        btnEditOrders.addActionListener(this::onEditOrdersAction);&#10;        btnClearOrders.addActionListener(this::onClearOrdersAction);&#10;        btnGetBill.addActionListener(this::onGetBillAction);&#10;        btnBillAndClose.addActionListener(this::onBillAndCloseAction);&#10;        btnViewOrders.addActionListener(this::onViewOrdersAction);&#10;&#10;        // Update orders when table selection changes&#10;        table.getSelectionModel().addListSelectionListener(e -&gt; {&#10;            if (!e.getValueIsAdjusting()) refreshOrdersForSelectedTable();&#10;        });&#10;&#10;        // Listen to order changes so UI updates when orders are added from other panels&#10;        tableService.addOrderListener(() -&gt; SwingUtilities.invokeLater(() -&gt; {&#10;            refreshTable();&#10;            refreshOrdersForSelectedTable();&#10;        }));&#10;&#10;        // Right-click on table rows to view order details&#10;        table.addMouseListener(new MouseAdapter() {&#10;            @Override public void mousePressed(MouseEvent e) { maybeShowPopup(e); }&#10;            @Override public void mouseReleased(MouseEvent e) { maybeShowPopup(e); }&#10;            private void maybeShowPopup(MouseEvent e) {&#10;                if (e.isPopupTrigger()) {&#10;                    int row = table.rowAtPoint(e.getPoint());&#10;                    if (row &gt;= 0) table.setRowSelectionInterval(row, row);&#10;                    Integer tableId = getSelectedTableId();&#10;                    if (tableId != null) {&#10;                        JPopupMenu pm = new JPopupMenu();&#10;                        JMenuItem mi = new JMenuItem(new AbstractAction(&quot;View Orders&quot;) {&#10;                            @Override public void actionPerformed(ActionEvent e) { viewOrdersDialog(tableId); }&#10;                        });&#10;                        pm.add(mi);&#10;                        pm.show(table, e.getX(), e.getY());&#10;                     }&#10;                 }&#10;             }&#10;         });&#10;&#10;        refreshTable();&#10;    }&#10;&#10;    private Integer getSelectedTableId() {&#10;        int row = table.getSelectedRow();&#10;        if (row &lt; 0) return null;&#10;        Object idObj = tableModel.getValueAt(row, 0);&#10;        try { return Integer.parseInt(String.valueOf(idObj)); } catch (Exception ex) { return null; }&#10;    }&#10;&#10;    private void onAssign() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        // Show a selector of reservations that are not cancelled and not already assigned&#10;        java.util.List&lt;Reservation&gt; candidates = reservationService.getAll().stream()&#10;                .filter(r -&gt; r.getStatus() != org.models.ReservationStatus.CANCELLED &amp;&amp; r.getTableId() == null)&#10;                .toList();&#10;        if (candidates.isEmpty()) {&#10;            JOptionPane.showMessageDialog(this, &quot;No available reservations to assign.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;            return;&#10;        }&#10;        JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;();&#10;        Map&lt;String, Integer&gt; keyToId = new HashMap&lt;&gt;();&#10;        for (Reservation r : candidates) {&#10;            String key = r.getId() + &quot; - &quot; + r.getCustomerName() + &quot; (&quot; + r.getGuests() + &quot;)&quot;;&#10;            combo.addItem(key);&#10;            keyToId.put(key, r.getId());&#10;        }&#10;        int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select reservation to assign&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;        if (res != JOptionPane.OK_OPTION) return;&#10;        String chosen = (String) combo.getSelectedItem();&#10;        if (chosen == null) return;&#10;        int resId = keyToId.get(chosen);&#10;        try {&#10;            boolean ok = reservationService.assignTableToReservation(resId, tableId);&#10;            if (ok) {&#10;                JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; assigned to reservation &quot; + resId);&#10;                refreshTable();&#10;            } else {&#10;                JOptionPane.showMessageDialog(this, &quot;Failed to assign table. Ensure table is free and reservation exists.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        } catch (ReservationNotFoundException rnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Reservation not found: &quot; + rnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // New: seat a reservation for the selected table (mark it occupied)&#10;    private void onSeat() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        Mesa m = tableService.getMesas().get(tableId);&#10;        if (m == null) { JOptionPane.showMessageDialog(this, &quot;Table not found.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;&#10;        var optRes = reservationService.findByTableId(tableId);&#10;        if (optRes.isPresent()) {&#10;            Reservation r = optRes.get();&#10;            int res = JOptionPane.showConfirmDialog(this,&#10;                    &quot;Seat reservation &quot; + r.getId() + &quot; for &quot; + r.getCustomerName() + &quot; now?&quot;,&#10;                    &quot;Seat Reservation&quot;,&#10;                    JOptionPane.YES_NO_OPTION);&#10;            if (res == JOptionPane.YES_OPTION) {&#10;                boolean ok = reservationService.seatReservation(r.getId());&#10;                if (ok) {&#10;                    JOptionPane.showMessageDialog(this, &quot;Reservation seated; table &quot; + m.getId() + &quot; is now occupied.&quot;);&#10;                    // Prompt for orders immediately after seating from floor map&#10;                   promptAndAddOrders(m.getId());&#10;                   refreshTable();&#10;                } else {&#10;                    JOptionPane.showMessageDialog(this, &quot;Failed to seat reservation.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                }&#10;            }&#10;        } else {&#10;            // No reservation assigned to this table — allow seating as a walk-in (mark occupied)&#10;            if (m.getEstado() == org.models.TableStatus.OCUPADA) {&#10;                JOptionPane.showMessageDialog(this, &quot;Table is already occupied.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                return;&#10;            }&#10;            int res = JOptionPane.showConfirmDialog(this,&#10;                    &quot;No reservation assigned. Mark table &quot; + m.getId() + &quot; as occupied for a walk-in?&quot;,&#10;                    &quot;Seat Walk-in&quot;,&#10;                    JOptionPane.YES_NO_OPTION);&#10;            if (res == JOptionPane.YES_OPTION) {&#10;                try {&#10;                    boolean ok = tableService.occupyTable(m.getId());&#10;                    if (ok) {&#10;                        // Prompt for orders for the walk-in immediately&#10;                        promptAndAddOrders(m.getId());&#10;                        refreshTable();&#10;                    } else {&#10;                        JOptionPane.showMessageDialog(this, &quot;Failed to mark table as occupied.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                    }&#10;                } catch (org.exceptions.TableNotFoundException tnfe) {&#10;                    JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private void onRelease() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        try {&#10;            boolean ok = tableService.releaseTable(tableId);&#10;            if (ok) {&#10;                // also clear reservation assignment if any&#10;                var opt = reservationService.findByTableId(tableId);&#10;                opt.ifPresent(r -&gt; r.setTableId(null));&#10;                // cancel any orders for this table (mark cancelled and cancel linked production jobs)&#10;                try {&#10;                    tableService.cancelOrdersForTable(tableId);&#10;                } catch (Exception ignored) {}&#10;                JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; released and orders cancelled.&quot;);&#10;                refreshTable();&#10;            } else {&#10;                JOptionPane.showMessageDialog(this, &quot;Failed to release table.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // Dialog to create a new reservation and assign to a table&#10;    private void createAndAssignReservation(int tableId, int capacidad) {&#10;        JPanel panel = new JPanel(new GridLayout(0, 2));&#10;        JTextField customerField = new JTextField();&#10;        JSpinner guestsSpinner = new JSpinner(new SpinnerNumberModel(1, 1, capacidad, 1));&#10;        JSpinner dateSpinner = new JSpinner(new SpinnerDateModel());&#10;        panel.add(new JLabel(&quot;Customer Name:&quot;)); panel.add(customerField);&#10;        panel.add(new JLabel(&quot;Guests:&quot;)); panel.add(guestsSpinner);&#10;        panel.add(new JLabel(&quot;Date &amp; Time:&quot;)); panel.add(dateSpinner);&#10;        int res = JOptionPane.showConfirmDialog(this, panel, &quot;New Reservation&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;        if (res != JOptionPane.OK_OPTION) return;&#10;        String customer = customerField.getText().trim();&#10;        int guests = (Integer) guestsSpinner.getValue();&#10;        java.util.Date date = (java.util.Date) dateSpinner.getValue();&#10;        java.time.LocalDateTime when = java.time.LocalDateTime.ofInstant(date.toInstant(), java.time.ZoneId.systemDefault());&#10;        if (customer.isEmpty()) {&#10;            JOptionPane.showMessageDialog(this, &quot;Customer name required.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            return;&#10;        }&#10;        // Create reservation&#10;        Reservation r = reservationService.createReservation(customer, guests, when);&#10;        r.setTableId(tableId);&#10;        r.setStatus(org.models.ReservationStatus.CONFIRMED);&#10;        try {&#10;            tableService.assignTable(tableId);&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found when assigning: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            return;&#10;        }&#10;        JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; reserved for &quot; + customer);&#10;        refreshTable();&#10;    }&#10;&#10;    private void onAddOrder() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table if none selected&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;();&#10;            java.util.Map&lt;String, Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) {&#10;                String key = mm.getId() + &quot; - &quot; + mm.getEstado();&#10;                combo.addItem(key);&#10;                keyToId.put(key, mm.getId());&#10;            }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to add order&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return;&#10;            String chosen = (String) combo.getSelectedItem();&#10;            if (chosen == null) return;&#10;            tableId = keyToId.get(chosen);&#10;        }&#10;        promptAndAddOrders(tableId);&#10;    }&#10;&#10;    private void onClearOrders() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        int res = JOptionPane.showConfirmDialog(this, &quot;Clear all orders for table &quot; + tableId + &quot;?&quot;, &quot;Confirm&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.WARNING_MESSAGE);&#10;        if (res != JOptionPane.OK_OPTION) return;&#10;        try {&#10;            tableService.clearOrders(tableId);&#10;            refreshOrdersForSelectedTable();&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    private void onGetBill() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; orders = tableService.getOrders(tableId);&#10;&#10;            // Determine customer name: prefer reservation's customer; if none and table is occupied, ask for it&#10;            String customerName = null;&#10;            var optRes = reservationService.findByTableId(tableId);&#10;            if (optRes.isPresent()) {&#10;                customerName = optRes.get().getCustomerName();&#10;            } else {&#10;                // no reservation assigned — if table is actually occupied, ask for customer name before billing&#10;                Mesa m = tableService.getMesas().get(tableId);&#10;                if (m != null &amp;&amp; m.getEstado() == org.models.TableStatus.OCUPADA) {&#10;                    String input = (String) JOptionPane.showInputDialog(this,&#10;                            &quot;Enter customer name for table &quot; + tableId + &quot;:&quot;,&#10;                            &quot;Customer required&quot;,&#10;                            JOptionPane.PLAIN_MESSAGE,&#10;                            null,&#10;                            null,&#10;                            &quot;&quot;);&#10;                    if (input == null) return; // user cancelled&#10;                    input = input.trim();&#10;                    if (input.isEmpty()) {&#10;                        JOptionPane.showMessageDialog(this, &quot;Customer name required to generate the bill.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                        return;&#10;                    }&#10;                    customerName = input;&#10;                }&#10;            }&#10;&#10;            Factura factura = new Factura(tableId, orders, menu);&#10;            StringBuilder fullText = new StringBuilder();&#10;            if (customerName != null &amp;&amp; !customerName.isEmpty()) {&#10;                fullText.append(&quot;Customer: &quot;).append(customerName).append('\n');&#10;            }&#10;            // StringBuilder.append(Object) will call toString() internally&#10;            fullText.append(factura);&#10;&#10;            JTextArea ta = new JTextArea(fullText.toString());&#10;            ta.setEditable(false);&#10;            ta.setRows(Math.min(20, factura.getItems().size() + 6));&#10;            ta.setColumns(50);&#10;            int res = JOptionPane.showOptionDialog(this, new JScrollPane(ta), &quot;Factura - Table &quot; + tableId,&#10;                    JOptionPane.YES_NO_OPTION, JOptionPane.PLAIN_MESSAGE, null, new String[] {&quot;Close&quot;,&quot;Settle &amp; Clear&quot;}, &quot;Close&quot;);&#10;            if (res == JOptionPane.NO_OPTION) {&#10;                // Settle: clear orders and release table&#10;                try {&#10;                    // Clear orders&#10;                    tableService.clearOrders(tableId);&#10;                    // release the mesa and remove reservation assignment if any&#10;                    try {&#10;                        boolean ok = tableService.releaseTable(tableId);&#10;                        if (ok) {&#10;                            var opt = reservationService.findByTableId(tableId);&#10;                            opt.ifPresent(r -&gt; r.setTableId(null));&#10;                        }&#10;                    } catch (TableNotFoundException ignored) {}&#10;                } catch (Exception ignored) {}&#10;                refreshTable();&#10;            }&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // Produce the bill (show factura) and immediately settle: clear orders, release table and remove reservation assignment&#10;    private void onBillAndClose() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) { JOptionPane.showMessageDialog(this, &quot;Select a table first.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; orders = tableService.getOrders(tableId);&#10;            if (orders.isEmpty()) {&#10;                JOptionPane.showMessageDialog(this, &quot;No orders for table &quot; + tableId, &quot;Orders&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                return;&#10;            }&#10;&#10;            // Determine customer name: prefer reservation's customer; if none and table is occupied, ask for it&#10;            String customerName = null;&#10;            var optRes = reservationService.findByTableId(tableId);&#10;            if (optRes.isPresent()) {&#10;                customerName = optRes.get().getCustomerName();&#10;            } else {&#10;                Mesa m = tableService.getMesas().get(tableId);&#10;                if (m != null &amp;&amp; m.getEstado() == org.models.TableStatus.OCUPADA) {&#10;                    String input = (String) JOptionPane.showInputDialog(this,&#10;                            &quot;Enter customer name for table &quot; + tableId + &quot;:&quot;,&#10;                            &quot;Customer required&quot;,&#10;                            JOptionPane.PLAIN_MESSAGE,&#10;                            null,&#10;                            null,&#10;                            &quot;&quot;);&#10;                    if (input == null) return; // user cancelled&#10;                    input = input.trim();&#10;                    if (input.isEmpty()) {&#10;                        JOptionPane.showMessageDialog(this, &quot;Customer name required to generate the bill.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                        return;&#10;                    }&#10;                    customerName = input;&#10;                }&#10;            }&#10;&#10;            Factura factura = new Factura(tableId, orders, menu);&#10;            StringBuilder fullText = new StringBuilder();&#10;            if (customerName != null &amp;&amp; !customerName.isEmpty()) fullText.append(&quot;Customer: &quot;).append(customerName).append('\n');&#10;            fullText.append(factura);&#10;&#10;            JTextArea ta = new JTextArea(fullText.toString());&#10;            ta.setEditable(false);&#10;            ta.setRows(Math.min(20, factura.getItems().size() + 6));&#10;            ta.setColumns(50);&#10;            JOptionPane.showMessageDialog(this, new JScrollPane(ta), &quot;Factura - Table &quot; + tableId, JOptionPane.PLAIN_MESSAGE);&#10;&#10;            // Settle: clear orders and release table and remove reservation assignment if any&#10;            try {&#10;                tableService.clearOrders(tableId);&#10;            } catch (TableNotFoundException ignored) {}&#10;            try {&#10;                boolean ok = tableService.releaseTable(tableId);&#10;                if (ok) {&#10;                    var opt = reservationService.findByTableId(tableId);&#10;                    opt.ifPresent(r -&gt; r.setTableId(null));&#10;                }&#10;            } catch (TableNotFoundException ignored) {}&#10;&#10;            refreshTable();&#10;            JOptionPane.showMessageDialog(this, &quot;Table &quot; + tableId + &quot; settled and closed.&quot;);&#10;&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    private void refreshOrdersForSelectedTable() {&#10;        ordersModel.clear();&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) return;&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; list = new java.util.ArrayList&lt;&gt;(tableService.getOrders(tableId));&#10;            list.sort((a,b) -&gt; {&#10;                Long ta = a.getEstimatedMinutes();&#10;                Long tb = b.getEstimatedMinutes();&#10;                if (ta == null &amp;&amp; tb == null) return 0;&#10;                if (ta == null) return 1;&#10;                if (tb == null) return -1;&#10;                return ta.compareTo(tb);&#10;            });&#10;            for (OrderItem oi : list) ordersModel.addElement(oi);&#10;        } catch (TableNotFoundException tnfe) {&#10;            // ignore&#10;        }&#10;    }&#10;&#10;    private void showOrderDetails(int tableId) {&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; orders = tableService.getOrders(tableId);&#10;            if (orders.isEmpty()) {&#10;                JOptionPane.showMessageDialog(this, &quot;No orders for table &quot; + tableId, &quot;Orders&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                return;&#10;            }&#10;            StringBuilder sb = new StringBuilder();&#10;            sb.append(&quot;Orders for table &quot;).append(tableId).append(&quot;\n\n&quot;);&#10;            for (OrderItem oi : orders) sb.append(oi.toString()).append(&quot;\n&quot;);&#10;            JTextArea ta = new JTextArea(sb.toString());&#10;            ta.setEditable(false);&#10;            ta.setRows(Math.min(orders.size()+2, 15));&#10;            ta.setColumns(40);&#10;            JOptionPane.showMessageDialog(this, new JScrollPane(ta), &quot;Order Details&quot;, JOptionPane.PLAIN_MESSAGE);&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    public void refreshTable() {&#10;        tableModel.setRowCount(0);&#10;        tableButtons.clear();&#10;        floorPanel.removeAll();&#10;        for (Map.Entry&lt;Integer, Mesa&gt; e : tableService.getMesas().entrySet()) {&#10;            Mesa m = e.getValue();&#10;            String reservationId = &quot;-&quot;;&#10;            String customer = &quot;-&quot;;&#10;            var opt = reservationService.findByTableId(m.getId());&#10;            if (opt.isPresent()) {&#10;                Reservation r = opt.get();&#10;                reservationId = String.valueOf(r.getId());&#10;                customer = r.getCustomerName();&#10;            }&#10;            Object[] row = new Object[] { m.getId(), m.getCapacidad(), m.getEstado(), reservationId, customer };&#10;            tableModel.addRow(row);&#10;&#10;            // Create a visual button for the floor map&#10;            JButton tb = new JButton(&quot;Table &quot; + m.getId());&#10;            // let GridLayout size buttons evenly; keep a comfortable margin and tooltip for capacity&#10;            tb.setMargin(new Insets(6,6,6,6));&#10;            tb.setToolTipText(&quot;Capacity: &quot; + m.getCapacidad());&#10;            tb.setVerticalTextPosition(SwingConstants.CENTER);&#10;            tb.setHorizontalTextPosition(SwingConstants.CENTER);&#10;             // color by status&#10;             switch (m.getEstado()) {&#10;                 case LIBRE -&gt; tb.setBackground(new Color(200,255,200));&#10;                 case RESERVADA -&gt; tb.setBackground(new Color(255,230,150));&#10;                 case OCUPADA -&gt; tb.setBackground(new Color(255,150,150));&#10;                 default -&gt; tb.setBackground(UIManager.getColor(&quot;Button.background&quot;));&#10;             }&#10;             // select table in table when clicked&#10;             tb.addActionListener(ae -&gt; {&#10;                 // select row in table&#10;                 for (int rowIdx = 0; rowIdx &lt; tableModel.getRowCount(); rowIdx++) {&#10;                     if (String.valueOf(tableModel.getValueAt(rowIdx,0)).equals(String.valueOf(m.getId()))) {&#10;                         table.setRowSelectionInterval(rowIdx, rowIdx);&#10;                         table.scrollRectToVisible(table.getCellRect(rowIdx, 0, true));&#10;                         break;&#10;                     }&#10;                 }&#10;                 // refresh orders view for this table&#10;                 refreshOrdersForSelectedTable();&#10;                 // show unified actions dialog for this table (view/edit/add orders + status actions)&#10;                 showTableActions(m);&#10;             });&#10;            floorPanel.add(tb);&#10;            tableButtons.put(m.getId(), tb);&#10;        }&#10;        // adapt floorPanel to a square-ish grid based on number of tables&#10;        int n = tableButtons.size();&#10;        if (n &gt; 0) {&#10;            int cols = (int) Math.ceil(Math.sqrt(n));&#10;            cols = Math.max(1, Math.min(cols, 6)); // limit columns for usability&#10;            floorPanel.setLayout(new GridLayout(0, cols, 10, 10));&#10;        } else {&#10;            floorPanel.setLayout(new GridLayout(0, 1, 10, 10));&#10;        }&#10;        floorPanel.revalidate();&#10;        floorPanel.repaint();&#10;&#10;        // attempt to refresh orders for currently selected row&#10;        refreshOrdersForSelectedTable();&#10;    }&#10;&#10;    // --- Action wrappers to avoid unused-lambda warnings from static analysis ---&#10;    private void onRefreshAction(ActionEvent e) { refreshTable(); }&#10;    private void onAssignAction(ActionEvent e) { onAssign(); }&#10;    private void onSeatAction(ActionEvent e) { onSeat(); }&#10;    private void onReleaseAction(ActionEvent e) { onRelease(); }&#10;    private void onAddOrderAction(ActionEvent e) {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table if none selected&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;();&#10;            java.util.Map&lt;String, Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) {&#10;                String key = mm.getId() + &quot; - &quot; + mm.getEstado();&#10;                combo.addItem(key);&#10;                keyToId.put(key, mm.getId());&#10;            }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to add order&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return;&#10;            String chosen = (String) combo.getSelectedItem();&#10;            if (chosen == null) return;&#10;            tableId = keyToId.get(chosen);&#10;        }&#10;        promptAndAddOrders(tableId);&#10;    }&#10;    private void onClearOrdersAction(ActionEvent e) { onClearOrders(); }&#10;    private void onGetBillAction(ActionEvent e) { onGetBill(); }&#10;    private void onBillAndCloseAction(ActionEvent e) { onBillAndClose(); }&#10;    // Wrapper for View Orders button&#10;    private void onViewOrdersAction(ActionEvent e) { onViewOrders(); }&#10;&#10;    private void onViewOrders() {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;(); java.util.Map&lt;String,Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) { String key = mm.getId() + &quot; - &quot; + mm.getEstado(); combo.addItem(key); keyToId.put(key, mm.getId()); }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to view orders&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return; String chosen = (String) combo.getSelectedItem(); if (chosen == null) return; tableId = keyToId.get(chosen);&#10;        }&#10;        viewOrdersDialog(tableId);&#10;    }&#10;&#10;    // Unified orders dialog: view list and allow add/edit/remove/bill from one place&#10;    private void viewOrdersDialog(int tableId) {&#10;        try {&#10;            JDialog dlg = new JDialog(SwingUtilities.getWindowAncestor(this), &quot;Orders - Table &quot; + tableId, Dialog.ModalityType.APPLICATION_MODAL);&#10;            dlg.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);&#10;            dlg.setLayout(new BorderLayout(8,8));&#10;&#10;            DefaultListModel&lt;OrderItem&gt; model = new DefaultListModel&lt;&gt;();&#10;            java.util.List&lt;OrderItem&gt; list = new java.util.ArrayList&lt;&gt;(tableService.getOrders(tableId));&#10;            for (OrderItem oi : list) model.addElement(oi);&#10;            JList&lt;OrderItem&gt; jlist = new JList&lt;&gt;(model);&#10;            jlist.setVisibleRowCount(12);&#10;            dlg.add(new JScrollPane(jlist), BorderLayout.CENTER);&#10;&#10;            JPanel btns = new JPanel(new FlowLayout(FlowLayout.RIGHT));&#10;            JButton btnAdd = new JButton(&quot;Add&quot;);&#10;            JButton btnEdit = new JButton(&quot;Edit&quot;);&#10;            JButton btnRemove = new JButton(&quot;Remove&quot;);&#10;            JButton btnBillClose = new JButton(&quot;Bill &amp; Close&quot;);&#10;            JButton btnClose = new JButton(&quot;Close&quot;);&#10;            btns.add(btnAdd); btns.add(btnEdit); btns.add(btnRemove); btns.add(btnBillClose); btns.add(btnClose);&#10;            dlg.add(btns, BorderLayout.SOUTH);&#10;&#10;            btnAdd.addActionListener(ae -&gt; { dlg.dispose(); promptAndAddOrders(tableId); refreshOrdersForSelectedTable(); viewOrdersDialog(tableId); });&#10;            btnEdit.addActionListener(ae -&gt; { dlg.dispose(); editOrdersDialog(tableId); refreshOrdersForSelectedTable(); viewOrdersDialog(tableId); });&#10;            btnRemove.addActionListener(ae -&gt; {&#10;                int idx = jlist.getSelectedIndex();&#10;                if (idx &lt; 0) { JOptionPane.showMessageDialog(dlg, &quot;Select an item to remove.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;                try {&#10;                    boolean ok = tableService.removeOrderItem(tableId, idx);&#10;                    if (ok) { model.remove(idx); refreshOrdersForSelectedTable(); }&#10;                } catch (TableNotFoundException tnfe) { JOptionPane.showMessageDialog(dlg, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); }&#10;            });&#10;            btnBillClose.addActionListener(ae -&gt; { dlg.dispose(); onBillAndClose(); });&#10;            btnClose.addActionListener(ae -&gt; dlg.dispose());&#10;&#10;            dlg.pack(); dlg.setLocationRelativeTo(this); dlg.setVisible(true);&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // Nicer dialog to add multiple order items to the given table&#10;    private void promptAndAddOrders(int tableId) {&#10;        JDialog dlg = new JDialog(SwingUtilities.getWindowAncestor(this), &quot;Add Orders - Table &quot; + tableId, Dialog.ModalityType.APPLICATION_MODAL);&#10;        dlg.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);&#10;        dlg.setLayout(new BorderLayout(10,10));&#10;&#10;        // Left: menu selection (or manual entry if no menu)&#10;        JPanel left = new JPanel(new BorderLayout(5,5));&#10;        left.setBorder(BorderFactory.createTitledBorder(&quot;Menu Items&quot;));&#10;        DefaultListModel&lt;String&gt; menuModel = new DefaultListModel&lt;&gt;();&#10;        java.util.List&lt;org.models.Recipe&gt; recipes = new java.util.ArrayList&lt;&gt;();&#10;        if (menu != null) {&#10;            for (org.models.Recipe r : menu.getAll().values()) { menuModel.addElement(r.getNombre()); recipes.add(r); }&#10;        }&#10;        JList&lt;String&gt; menuList = new JList&lt;&gt;(menuModel);&#10;        menuList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);&#10;        left.add(new JScrollPane(menuList), BorderLayout.CENTER);&#10;&#10;        JPanel manual = new JPanel(new GridLayout(0,1,4,4));&#10;        JTextField manualName = new JTextField();&#10;        JSpinner manualQty = new JSpinner(new SpinnerNumberModel(1,1,100,1));&#10;        manual.add(new JLabel(&quot;Manual name (if not using menu):&quot;)); manual.add(manualName);&#10;        manual.add(new JLabel(&quot;Quantity:&quot;)); manual.add(manualQty);&#10;        left.add(manual, BorderLayout.SOUTH);&#10;&#10;        // Center: add controls&#10;        JPanel center = new JPanel(new GridLayout(0,1,4,4));&#10;        JButton btnAdd = new JButton(&quot;Add to preview&quot;);&#10;        center.add(btnAdd);&#10;&#10;        // Right: preview of items to be added&#10;        DefaultListModel&lt;OrderItem&gt; previewModel = new DefaultListModel&lt;&gt;();&#10;        JList&lt;OrderItem&gt; previewList = new JList&lt;&gt;(previewModel);&#10;        previewList.setVisibleRowCount(8);&#10;        JPanel right = new JPanel(new BorderLayout(5,5));&#10;        right.setBorder(BorderFactory.createTitledBorder(&quot;Preview (will be added to table)&quot;));&#10;        right.add(new JScrollPane(previewList), BorderLayout.CENTER);&#10;        JPanel previewButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;        JButton btnRemove = new JButton(&quot;Remove&quot;);&#10;        previewButtons.add(btnRemove);&#10;        right.add(previewButtons, BorderLayout.SOUTH);&#10;&#10;        // Bottom: confirm/cancel&#10;        JPanel bottom = new JPanel(new FlowLayout(FlowLayout.RIGHT));&#10;        JButton btnConfirm = new JButton(&quot;Confirm and Add&quot;);&#10;        JButton btnCancel = new JButton(&quot;Cancel&quot;);&#10;        bottom.add(btnCancel); bottom.add(btnConfirm);&#10;&#10;        // Wire actions&#10;        btnAdd.addActionListener(ae -&gt; {&#10;            String selected = menuList.getSelectedValue();&#10;            int qty = (Integer) manualQty.getValue();&#10;            if (selected != null &amp;&amp; !selected.isEmpty()) {&#10;                // find recipe id&#10;                Integer rid = null;&#10;                for (org.models.Recipe r : recipes) if (r.getNombre().equals(selected)) { rid = r.getId(); break; }&#10;                previewModel.addElement(new OrderItem(selected, qty, rid));&#10;            } else {&#10;                String name = manualName.getText().trim();&#10;                if (name.isEmpty()) { JOptionPane.showMessageDialog(dlg, &quot;Enter a name or select a menu item.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;                previewModel.addElement(new OrderItem(name, qty, null));&#10;            }&#10;        });&#10;&#10;        btnRemove.addActionListener(ae -&gt; {&#10;            int idx = previewList.getSelectedIndex();&#10;            if (idx &gt;= 0) previewModel.remove(idx);&#10;        });&#10;&#10;        btnCancel.addActionListener(ae -&gt; dlg.dispose());&#10;&#10;        btnConfirm.addActionListener(ae -&gt; {&#10;            if (previewModel.isEmpty()) { dlg.dispose(); return; }&#10;            try {&#10;                for (int i=0;i&lt;previewModel.size();i++) {&#10;                    OrderItem oi = previewModel.get(i);&#10;                    tableService.addOrder(tableId, oi);&#10;                }&#10;                dlg.dispose();&#10;                JOptionPane.showMessageDialog(this, &quot;Added &quot; + previewModel.size() + &quot; order(s) to table &quot; + tableId + &quot;.&quot;);&#10;                refreshOrdersForSelectedTable();&#10;            } catch (TableNotFoundException tnfe) {&#10;                JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;            }&#10;        });&#10;&#10;        // Layout main dialog&#10;        JPanel mid = new JPanel(new BorderLayout(10,10));&#10;        mid.add(left, BorderLayout.WEST);&#10;        mid.add(center, BorderLayout.CENTER);&#10;        mid.add(right, BorderLayout.EAST);&#10;        dlg.add(mid, BorderLayout.CENTER);&#10;        dlg.add(bottom, BorderLayout.SOUTH);&#10;        dlg.pack();&#10;        dlg.setLocationRelativeTo(this);&#10;        dlg.setVisible(true);&#10;    }&#10;&#10;    // Open an edit dialog prepopulated with current orders; on confirm replace table's orders with preview&#10;    private void editOrdersDialog(int tableId) {&#10;        try {&#10;            java.util.List&lt;OrderItem&gt; existing = new java.util.ArrayList&lt;&gt;(tableService.getOrders(tableId));&#10;&#10;            JDialog dlg = new JDialog(SwingUtilities.getWindowAncestor(this), &quot;Edit Orders - Table &quot; + tableId, Dialog.ModalityType.APPLICATION_MODAL);&#10;            dlg.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);&#10;            dlg.setLayout(new BorderLayout(10,10));&#10;&#10;            // reuse prompt UI parts: menu list and manual entry&#10;            DefaultListModel&lt;String&gt; menuModel = new DefaultListModel&lt;&gt;();&#10;            java.util.List&lt;org.models.Recipe&gt; recipes = new java.util.ArrayList&lt;&gt;();&#10;            if (menu != null) for (org.models.Recipe r : menu.getAll().values()) { menuModel.addElement(r.getNombre()); recipes.add(r); }&#10;            JList&lt;String&gt; menuList = new JList&lt;&gt;(menuModel);&#10;            menuList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);&#10;&#10;            JPanel left = new JPanel(new BorderLayout(5,5));&#10;            left.setBorder(BorderFactory.createTitledBorder(&quot;Menu Items&quot;));&#10;            left.add(new JScrollPane(menuList), BorderLayout.CENTER);&#10;            JPanel manual = new JPanel(new GridLayout(0,1,4,4));&#10;            JTextField manualName = new JTextField();&#10;            JSpinner manualQty = new JSpinner(new SpinnerNumberModel(1,1,100,1));&#10;            manual.add(new JLabel(&quot;Manual name (if not using menu):&quot;)); manual.add(manualName);&#10;            manual.add(new JLabel(&quot;Quantity:&quot;)); manual.add(manualQty);&#10;            left.add(manual, BorderLayout.SOUTH);&#10;&#10;            JPanel center = new JPanel(new GridLayout(0,1,4,4));&#10;            JButton btnAdd = new JButton(&quot;Add to preview&quot;);&#10;            center.add(btnAdd);&#10;&#10;            DefaultListModel&lt;OrderItem&gt; previewModel = new DefaultListModel&lt;&gt;();&#10;            // clone existing orders into the preview so we don't reuse the same instances&#10;            for (OrderItem oi : existing) previewModel.addElement(new OrderItem(oi.getName(), oi.getQuantity(), oi.getRecipeId()));&#10;            JList&lt;OrderItem&gt; previewList = new JList&lt;&gt;(previewModel);&#10;            JPanel right = new JPanel(new BorderLayout(5,5));&#10;            right.setBorder(BorderFactory.createTitledBorder(&quot;Preview (will replace table orders)&quot;));&#10;            right.add(new JScrollPane(previewList), BorderLayout.CENTER);&#10;            JPanel previewButtons = new JPanel(new FlowLayout(FlowLayout.LEFT));&#10;            JButton btnRemove = new JButton(&quot;Remove&quot;); previewButtons.add(btnRemove);&#10;            right.add(previewButtons, BorderLayout.SOUTH);&#10;&#10;            JPanel bottom = new JPanel(new FlowLayout(FlowLayout.RIGHT));&#10;            JButton btnConfirm = new JButton(&quot;Confirm Changes&quot;); JButton btnCancel = new JButton(&quot;Cancel&quot;);&#10;            bottom.add(btnCancel); bottom.add(btnConfirm);&#10;&#10;            btnAdd.addActionListener(ae -&gt; {&#10;                String selected = menuList.getSelectedValue();&#10;                int qty = (Integer) manualQty.getValue();&#10;                if (selected != null &amp;&amp; !selected.isEmpty()) {&#10;                    Integer rid = null; for (org.models.Recipe r : recipes) if (r.getNombre().equals(selected)) { rid = r.getId(); break; }&#10;                    previewModel.addElement(new OrderItem(selected, qty, rid));&#10;                } else {&#10;                    String name = manualName.getText().trim(); if (name.isEmpty()) { JOptionPane.showMessageDialog(dlg, &quot;Enter a name or select a menu item.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); return; }&#10;                    previewModel.addElement(new OrderItem(name, qty, null));&#10;                }&#10;            });&#10;            btnRemove.addActionListener(ae -&gt; { int idx = previewList.getSelectedIndex(); if (idx &gt;= 0) previewModel.remove(idx); });&#10;            btnCancel.addActionListener(ae -&gt; dlg.dispose());&#10;&#10;            btnConfirm.addActionListener(ae -&gt; {&#10;                try {&#10;                    // mark existing orders CANCELLED and cancel their production jobs so kitchen updates&#10;                    tableService.cancelOrdersForTable(tableId);&#10;                    // then add the new preview items (these will create new production jobs as needed)&#10;                    for (int i=0;i&lt;previewModel.size();i++) {&#10;                        OrderItem oi = previewModel.get(i);&#10;                        // create a fresh OrderItem instance to avoid reusing any cancelled objects&#10;                        tableService.addOrder(tableId, new OrderItem(oi.getName(), oi.getQuantity(), oi.getRecipeId()));&#10;                    }&#10;                    dlg.dispose();&#10;                    JOptionPane.showMessageDialog(this, &quot;Updated orders for table &quot; + tableId);&#10;                    refreshOrdersForSelectedTable();&#10;                } catch (TableNotFoundException tnfe) {&#10;                    JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                }&#10;            });&#10;&#10;            JPanel mid = new JPanel(new BorderLayout(10,10)); mid.add(left, BorderLayout.WEST); mid.add(center, BorderLayout.CENTER); mid.add(right, BorderLayout.EAST);&#10;            dlg.add(mid, BorderLayout.CENTER); dlg.add(bottom, BorderLayout.SOUTH);&#10;            dlg.pack(); dlg.setLocationRelativeTo(this); dlg.setVisible(true);&#10;&#10;        } catch (TableNotFoundException tnfe) {&#10;            JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;        }&#10;    }&#10;&#10;    // Action wrapper for Edit Orders button&#10;    private void onEditOrdersAction(ActionEvent e) {&#10;        Integer tableId = getSelectedTableId();&#10;        if (tableId == null) {&#10;            // ask user to pick a table&#10;            java.util.Map&lt;Integer, Mesa&gt; mesas = tableService.getMesas();&#10;            if (mesas.isEmpty()) { JOptionPane.showMessageDialog(this, &quot;No tables available.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE); return; }&#10;            JComboBox&lt;String&gt; combo = new JComboBox&lt;&gt;(); java.util.Map&lt;String,Integer&gt; keyToId = new java.util.HashMap&lt;&gt;();&#10;            for (Mesa mm : mesas.values()) { String key = mm.getId() + &quot; - &quot; + mm.getEstado(); combo.addItem(key); keyToId.put(key, mm.getId()); }&#10;            int res = JOptionPane.showConfirmDialog(this, combo, &quot;Select table to edit orders&quot;, JOptionPane.OK_CANCEL_OPTION, JOptionPane.PLAIN_MESSAGE);&#10;            if (res != JOptionPane.OK_OPTION) return; String chosen = (String) combo.getSelectedItem(); if (chosen == null) return; tableId = keyToId.get(chosen);&#10;        }&#10;        editOrdersDialog(tableId);&#10;    }&#10;&#10;    // Show a unified dialog with table actions: view orders, edit orders, add orders, and status specific actions&#10;    private void showTableActions(Mesa m) {&#10;        java.util.List&lt;String&gt; opts = new java.util.ArrayList&lt;&gt;();&#10;        opts.add(&quot;View Orders&quot;);&#10;        // status-specific&#10;        switch (m.getEstado()) {&#10;            case LIBRE -&gt; {&#10;                opts.add(&quot;Create Reservation&quot;);&#10;                opts.add(&quot;Mark Occupied&quot;);&#10;            }&#10;            case RESERVADA -&gt; {&#10;                opts.add(&quot;Seat Reservation&quot;);&#10;                opts.add(&quot;Mark Occupied&quot;);&#10;            }&#10;            case OCUPADA -&gt; {&#10;                opts.add(&quot;Release Table&quot;);&#10;            }&#10;            default -&gt; {}&#10;        }&#10;        opts.add(&quot;Cancel&quot;);&#10;&#10;        String[] options = opts.toArray(new String[0]);&#10;        int choice = JOptionPane.showOptionDialog(this,&#10;                &quot;Table &quot; + m.getId() + &quot; - choose action:&quot;,&#10;                &quot;Table Actions&quot;,&#10;                JOptionPane.DEFAULT_OPTION,&#10;                JOptionPane.PLAIN_MESSAGE,&#10;                null,&#10;                options,&#10;                options[0]);&#10;&#10;        if (choice &lt; 0 || choice &gt;= options.length) return;&#10;        String sel = options[choice];&#10;        switch (sel) {&#10;            case &quot;View Orders&quot; -&gt; viewOrdersDialog(m.getId());&#10;            case &quot;Create Reservation&quot; -&gt; createAndAssignReservation(m.getId(), m.getCapacidad());&#10;            case &quot;Mark Occupied&quot; -&gt; {&#10;                try {&#10;                    boolean ok = tableService.occupyTable(m.getId());&#10;                    if (ok) { promptAndAddOrders(m.getId()); refreshTable(); }&#10;                } catch (TableNotFoundException tnfe) { JOptionPane.showMessageDialog(this, &quot;Table not found: &quot; + tnfe.getMessage(), &quot;Error&quot;, JOptionPane.ERROR_MESSAGE); }&#10;            }&#10;            case &quot;Seat Reservation&quot; -&gt; {&#10;                var opt = reservationService.findByTableId(m.getId());&#10;                if (opt.isPresent()) {&#10;                    Reservation r = opt.get();&#10;                    int res = JOptionPane.showConfirmDialog(this, &quot;Seat reservation &quot; + r.getId() + &quot; for &quot; + r.getCustomerName() + &quot; now?&quot;, &quot;Seat Reservation&quot;, JOptionPane.YES_NO_OPTION);&#10;                    if (res == JOptionPane.YES_OPTION) {&#10;                        boolean ok = reservationService.seatReservation(r.getId());&#10;                        if (ok) { JOptionPane.showMessageDialog(this, &quot;Reservation seated; table &quot; + m.getId() + &quot; is now occupied.&quot;); promptAndAddOrders(m.getId()); refreshTable(); }&#10;                        else JOptionPane.showMessageDialog(this, &quot;Failed to seat reservation.&quot;, &quot;Error&quot;, JOptionPane.ERROR_MESSAGE);&#10;                    }&#10;                } else {&#10;                    JOptionPane.showMessageDialog(this, &quot;No reservation found for this table.&quot;, &quot;Info&quot;, JOptionPane.INFORMATION_MESSAGE);&#10;                }&#10;            }&#10;            case &quot;Release Table&quot; -&gt; {&#10;                int res = JOptionPane.showConfirmDialog(this, &quot;Release table &quot; + m.getId() + &quot; now?&quot;, &quot;Release Table&quot;, JOptionPane.YES_NO_OPTION);&#10;                if (res == JOptionPane.YES_OPTION) onRelease();&#10;            }&#10;            default -&gt; {}&#10;        }&#10;    }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/models/Admin.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/models/Admin.java" />
              <option name="updatedContent" value="package org.models;&#10;&#10;public class Admin extends User {&#10;    public Admin(String username) {&#10;        super(username);&#10;    }&#10;&#10;    @Override&#10;    public boolean isAdmin() { return true; }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/models/Chef.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/models/Chef.java" />
              <option name="updatedContent" value="package org.models;&#10;&#10;public class Chef extends User {&#10;    public Chef(String username) {&#10;        super(username);&#10;    }&#10;&#10;    @Override&#10;    public boolean isChef() { return true; }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/models/TableService.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/models/TableService.java" />
              <option name="originalContent" value="package org.models;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import java.util.Optional;&#10;import java.util.List;&#10;import java.util.ArrayList;&#10;import java.util.Collections;&#10;import org.exceptions.TableNotFoundException;&#10;&#10;public class TableService {&#10;    private final Map&lt;Integer, Mesa&gt; mesas = new HashMap&lt;&gt;();&#10;    // Orders per table&#10;    private final Map&lt;Integer, List&lt;OrderItem&gt;&gt; orders = new HashMap&lt;&gt;();&#10;&#10;    // Simple listeners notified when orders change&#10;    private final List&lt;Runnable&gt; orderListeners = new ArrayList&lt;&gt;();&#10;&#10;    // Optional production integration&#10;    private Pedido productionService = null;&#10;    private Menu menu = null;&#10;&#10;    public synchronized void setProductionIntegration(Pedido productionService, Menu menu) {&#10;        this.productionService = productionService;&#10;        this.menu = menu;&#10;&#10;        // register a listener so when jobs update we refresh order ETAs&#10;        productionService.addJobListener(job -&gt; {&#10;            // update matching order items for this job&#10;            synchronized (this) {&#10;                java.time.LocalDateTime now = java.time.LocalDateTime.now();&#10;                for (List&lt;OrderItem&gt; list : orders.values()) {&#10;                    for (OrderItem oi : list) {&#10;                        Integer pid = oi.getProductionJobId();&#10;                        if (pid != null &amp;&amp; pid.equals(job.getId())) {&#10;                            switch (job.getStatus()) {&#10;                                case IN_PROGRESS -&gt; {&#10;                                    if (job.getStartedAt() != null) {&#10;                                        long dur = (long) job.getRecipe().getTiempoPreparacionMinutos() * (long) job.getQuantity();&#10;                                        long elapsed = java.time.Duration.between(job.getStartedAt(), now).toMinutes();&#10;                                        long remaining = Math.max(0L, dur - elapsed);&#10;                                        oi.setEstimatedMinutes(remaining);&#10;                                    }&#10;                                    oi.setEstado(EstadoPedido.IN_PROGRESS);&#10;                                }&#10;                                case DONE -&gt; {&#10;                                    oi.setEstimatedMinutes(0L);&#10;                                    oi.setEstado(EstadoPedido.DONE);&#10;                                }&#10;                                case QUEUED -&gt; {&#10;                                    // queued -&gt; mark as queued&#10;                                    oi.setEstado(EstadoPedido.QUEUED);&#10;                                }&#10;                                case FAILED -&gt; {&#10;                                    // map failed jobs to CANCELLED for orders (cancellations and failures)&#10;                                    oi.setEstimatedMinutes(null);&#10;                                    oi.setEstado(EstadoPedido.CANCELLED);&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;            notifyOrderListeners();&#10;        });&#10;    }&#10;&#10;    public void addMesa(Mesa m) {&#10;        mesas.put(m.getId(), m);&#10;    }&#10;&#10;    public Optional&lt;Mesa&gt; findAvailableTable(int guests) {&#10;        return mesas.values().stream()&#10;                .filter(m -&gt; m.getEstado() == TableStatus.LIBRE &amp;&amp; m.getCapacidad() &gt;= guests)&#10;                .findFirst();&#10;    }&#10;&#10;    // Throws TableNotFoundException if the mesaId is unknown&#10;    public boolean assignTable(int mesaId) throws TableNotFoundException {&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m == null) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        if (m.getEstado() != TableStatus.LIBRE) return false;&#10;        m.setEstado(TableStatus.RESERVADA);&#10;        return true;&#10;    }&#10;&#10;    public boolean occupyTable(int mesaId) throws TableNotFoundException {&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m == null) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        m.setEstado(TableStatus.OCUPADA);&#10;        return true;&#10;    }&#10;&#10;    public boolean releaseTable(int mesaId) throws TableNotFoundException {&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m == null) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        m.setEstado(TableStatus.LIBRE);&#10;        return true;&#10;    }&#10;&#10;    public Map&lt;Integer, Mesa&gt; getMesas() { return mesas; }&#10;&#10;    // Orders API&#10;    public synchronized void addOrder(int mesaId, OrderItem item) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        // mark table as occupied when someone places an order (they are sitting)&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m != null &amp;&amp; m.getEstado() != TableStatus.OCUPADA) {&#10;            m.setEstado(TableStatus.OCUPADA);&#10;        }&#10;        orders.computeIfAbsent(mesaId, k -&gt; new ArrayList&lt;&gt;()).add(item);&#10;&#10;        // If integrated with production and item links to a recipe, create a production job automatically&#10;        if (productionService != null &amp;&amp; menu != null &amp;&amp; item.getRecipeId() != null) {&#10;            Recipe r = menu.getRecipeById(item.getRecipeId());&#10;            if (r != null) {&#10;                // Estimate ETA in minutes before creating the job (so it doesn't include the new job twice)&#10;                long etaMinutes = productionService.estimateCompletionForNewJob(r, item.getQuantity());&#10;                ProductionJob job = productionService.createJob(r, item.getQuantity());&#10;                if (job != null) {&#10;                    item.setProductionJobId(job.getId());&#10;                    item.setEstimatedMinutes(etaMinutes);&#10;                }&#10;            }&#10;        }&#10;        notifyOrderListeners();&#10;    }&#10;&#10;    public synchronized List&lt;OrderItem&gt; getOrders(int mesaId) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        return Collections.unmodifiableList(orders.getOrDefault(mesaId, new ArrayList&lt;&gt;()));&#10;    }&#10;&#10;    public synchronized void clearOrders(int mesaId) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        // If integrated with production, cancel any linked production jobs before removing orders&#10;        List&lt;OrderItem&gt; list = orders.get(mesaId);&#10;        if (list != null &amp;&amp; !list.isEmpty()) {&#10;            for (OrderItem oi : list) {&#10;                // mark cancelled locally&#10;                oi.setEstado(EstadoPedido.CANCELLED);&#10;                Integer pid = oi.getProductionJobId();&#10;                if (pid != null &amp;&amp; productionService != null) {&#10;                    try { productionService.cancelJob(pid); } catch (Exception ignored) {}&#10;                }&#10;            }&#10;        }&#10;        // remove orders entry&#10;        orders.remove(mesaId);&#10;        notifyOrderListeners();&#10;    }&#10;&#10;    // Mark all orders for a table as CANCELLED and cancel their production jobs if present&#10;    public synchronized void cancelOrdersForTable(int mesaId) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        List&lt;OrderItem&gt; list = orders.get(mesaId);&#10;        if (list == null || list.isEmpty()) return;&#10;        for (OrderItem oi : list) {&#10;            oi.setEstado(EstadoPedido.CANCELLED);&#10;            Integer pid = oi.getProductionJobId();&#10;            if (pid != null &amp;&amp; productionService != null) {&#10;                try {&#10;                    productionService.cancelJob(pid);&#10;                } catch (Exception ignored) {}&#10;            }&#10;        }&#10;        // keep the orders in the map but marked cancelled so UI shows them as cancelled&#10;        notifyOrderListeners();&#10;    }&#10;&#10;    public synchronized void addOrderListener(Runnable l) {&#10;        orderListeners.add(l);&#10;    }&#10;&#10;    public synchronized void removeOrderListener(Runnable l) {&#10;        orderListeners.remove(l);&#10;    }&#10;&#10;    private void notifyOrderListeners() {&#10;        for (Runnable r : new ArrayList&lt;&gt;(orderListeners)) {&#10;            try { r.run(); } catch (Exception ignored) {}&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package org.models;&#10;&#10;import java.util.HashMap;&#10;import java.util.Map;&#10;import java.util.Optional;&#10;import java.util.List;&#10;import java.util.ArrayList;&#10;import java.util.Collections;&#10;import org.exceptions.TableNotFoundException;&#10;&#10;public class TableService {&#10;    private final Map&lt;Integer, Mesa&gt; mesas = new HashMap&lt;&gt;();&#10;    // Orders per table&#10;    private final Map&lt;Integer, List&lt;OrderItem&gt;&gt; orders = new HashMap&lt;&gt;();&#10;&#10;    // Simple listeners notified when orders change&#10;    private final List&lt;Runnable&gt; orderListeners = new ArrayList&lt;&gt;();&#10;&#10;    // Optional production integration&#10;    private Pedido productionService = null;&#10;    private Menu menu = null;&#10;&#10;    public synchronized void setProductionIntegration(Pedido productionService, Menu menu) {&#10;        this.productionService = productionService;&#10;        this.menu = menu;&#10;&#10;        // register a listener so when jobs update we refresh order ETAs&#10;        productionService.addJobListener(job -&gt; {&#10;            // update matching order items for this job&#10;            synchronized (this) {&#10;                java.time.LocalDateTime now = java.time.LocalDateTime.now();&#10;                for (List&lt;OrderItem&gt; list : orders.values()) {&#10;                    for (OrderItem oi : list) {&#10;                        Integer pid = oi.getProductionJobId();&#10;                        if (pid != null &amp;&amp; pid.equals(job.getId())) {&#10;                            switch (job.getStatus()) {&#10;                                case IN_PROGRESS -&gt; {&#10;                                    if (job.getStartedAt() != null) {&#10;                                        long dur = (long) job.getRecipe().getTiempoPreparacionMinutos() * (long) job.getQuantity();&#10;                                        long elapsed = java.time.Duration.between(job.getStartedAt(), now).toMinutes();&#10;                                        long remaining = Math.max(0L, dur - elapsed);&#10;                                        oi.setEstimatedMinutes(remaining);&#10;                                    }&#10;                                    oi.setEstado(EstadoPedido.IN_PROGRESS);&#10;                                }&#10;                                case DONE -&gt; {&#10;                                    oi.setEstimatedMinutes(0L);&#10;                                    oi.setEstado(EstadoPedido.DONE);&#10;                                }&#10;                                case QUEUED -&gt; {&#10;                                    // queued -&gt; mark as queued&#10;                                    oi.setEstado(EstadoPedido.QUEUED);&#10;                                }&#10;                                case FAILED -&gt; {&#10;                                    // map failed jobs to CANCELLED for orders (cancellations and failures)&#10;                                    oi.setEstimatedMinutes(null);&#10;                                    oi.setEstado(EstadoPedido.CANCELLED);&#10;                                }&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;            notifyOrderListeners();&#10;        });&#10;    }&#10;&#10;    public void addMesa(Mesa m) {&#10;        mesas.put(m.getId(), m);&#10;    }&#10;&#10;    public Optional&lt;Mesa&gt; findAvailableTable(int guests) {&#10;        return mesas.values().stream()&#10;                .filter(m -&gt; m.getEstado() == TableStatus.LIBRE &amp;&amp; m.getCapacidad() &gt;= guests)&#10;                .findFirst();&#10;    }&#10;&#10;    // Throws TableNotFoundException if the mesaId is unknown&#10;    public boolean assignTable(int mesaId) throws TableNotFoundException {&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m == null) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        if (m.getEstado() != TableStatus.LIBRE) return false;&#10;        m.setEstado(TableStatus.RESERVADA);&#10;        return true;&#10;    }&#10;&#10;    public boolean occupyTable(int mesaId) throws TableNotFoundException {&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m == null) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        m.setEstado(TableStatus.OCUPADA);&#10;        return true;&#10;    }&#10;&#10;    public boolean releaseTable(int mesaId) throws TableNotFoundException {&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m == null) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        m.setEstado(TableStatus.LIBRE);&#10;        return true;&#10;    }&#10;&#10;    public Map&lt;Integer, Mesa&gt; getMesas() { return mesas; }&#10;&#10;    // Orders API&#10;    public synchronized void addOrder(int mesaId, OrderItem item) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        // mark table as occupied when someone places an order (they are sitting)&#10;        Mesa m = mesas.get(mesaId);&#10;        if (m != null &amp;&amp; m.getEstado() != TableStatus.OCUPADA) {&#10;            m.setEstado(TableStatus.OCUPADA);&#10;        }&#10;        // Treat this OrderItem as a new order: ensure its state is QUEUED and clear any previous job linkage&#10;        item.setEstado(EstadoPedido.QUEUED);&#10;        item.setEstimatedMinutes(null);&#10;        item.setProductionJobId(null);&#10;&#10;        orders.computeIfAbsent(mesaId, k -&gt; new ArrayList&lt;&gt;()).add(item);&#10;&#10;        // If integrated with production and item links to a recipe, create a production job automatically&#10;        if (productionService != null &amp;&amp; menu != null &amp;&amp; item.getRecipeId() != null) {&#10;            Recipe r = menu.getRecipeById(item.getRecipeId());&#10;            if (r != null) {&#10;                // Estimate ETA in minutes before creating the job&#10;                long etaMinutes = productionService.estimateCompletionForNewJob(r, item.getQuantity());&#10;                ProductionJob job = productionService.createJob(r, item.getQuantity());&#10;                if (job != null) {&#10;                    // Link the created job to the order item and set ETA. Note: createJob notifies production listeners&#10;                    // immediately, so we update the order item state here to reflect the new queued job.&#10;                    item.setProductionJobId(job.getId());&#10;                    item.setEstimatedMinutes(etaMinutes);&#10;                    item.setEstado(EstadoPedido.QUEUED);&#10;                }&#10;            }&#10;        }&#10;        notifyOrderListeners();&#10;    }&#10;&#10;    public synchronized List&lt;OrderItem&gt; getOrders(int mesaId) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        return Collections.unmodifiableList(orders.getOrDefault(mesaId, new ArrayList&lt;&gt;()));&#10;    }&#10;&#10;    public synchronized void clearOrders(int mesaId) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        // If integrated with production, cancel any linked production jobs before removing orders&#10;        List&lt;OrderItem&gt; list = orders.get(mesaId);&#10;        if (list != null &amp;&amp; !list.isEmpty()) {&#10;            for (OrderItem oi : list) {&#10;                // mark cancelled locally&#10;                oi.setEstado(EstadoPedido.CANCELLED);&#10;                Integer pid = oi.getProductionJobId();&#10;                if (pid != null &amp;&amp; productionService != null) {&#10;                    try { productionService.cancelJob(pid); } catch (Exception ignored) {}&#10;                }&#10;            }&#10;        }&#10;        // remove orders entry&#10;        orders.remove(mesaId);&#10;        notifyOrderListeners();&#10;    }&#10;&#10;    // Mark all orders for a table as CANCELLED and cancel their production jobs if present&#10;    public synchronized void cancelOrdersForTable(int mesaId) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        List&lt;OrderItem&gt; list = orders.get(mesaId);&#10;        if (list == null || list.isEmpty()) return;&#10;        for (OrderItem oi : list) {&#10;            oi.setEstado(EstadoPedido.CANCELLED);&#10;            Integer pid = oi.getProductionJobId();&#10;            if (pid != null &amp;&amp; productionService != null) {&#10;                try {&#10;                    productionService.cancelJob(pid);&#10;                } catch (Exception ignored) {}&#10;            }&#10;        }&#10;        // keep the orders in the map but marked cancelled so UI shows them as cancelled&#10;        notifyOrderListeners();&#10;    }&#10;&#10;    // Remove a single order item by index for the given table. Cancels linked production job if present.&#10;    public synchronized boolean removeOrderItem(int mesaId, int index) throws TableNotFoundException {&#10;        if (!mesas.containsKey(mesaId)) throw new TableNotFoundException(&quot;Mesa ID &quot; + mesaId + &quot; no encontrada&quot;);&#10;        List&lt;OrderItem&gt; list = orders.get(mesaId);&#10;        if (list == null || list.isEmpty()) return false;&#10;        if (index &lt; 0 || index &gt;= list.size()) return false;&#10;        OrderItem oi = list.remove(index);&#10;        Integer pid = oi.getProductionJobId();&#10;        if (pid != null &amp;&amp; productionService != null) {&#10;            try { productionService.cancelJob(pid); } catch (Exception ignored) {}&#10;        }&#10;        // if list becomes empty, keep empty list or remove the entry to match clearOrders behaviour&#10;        if (list.isEmpty()) orders.remove(mesaId);&#10;        notifyOrderListeners();&#10;        return true;&#10;    }&#10;&#10;    public synchronized void addOrderListener(Runnable l) {&#10;        orderListeners.add(l);&#10;    }&#10;&#10;    public synchronized void removeOrderListener(Runnable l) {&#10;        orderListeners.remove(l);&#10;    }&#10;&#10;    private void notifyOrderListeners() {&#10;        for (Runnable r : new ArrayList&lt;&gt;(orderListeners)) {&#10;            try { r.run(); } catch (Exception ignored) {}&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/models/User.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/models/User.java" />
              <option name="originalContent" value="package org.models;&#10;&#10;public class User {&#10;    private final String username;&#10;    private final boolean admin;&#10;    private final boolean admin;&#10;    public User(String username, boolean admin) {&#10;    public User(String username, boolean admin) {&#10;        this.admin = admin;&#10;    public User(String username, boolean admin) {&#10;        this.admin = admin;&#10;    public User(String username, boolean admin) {&#10;    public boolean isAdmin() { return admin; }&#10;}&#10;        this.admin = admin;&#10;        this.admin = admin;&#10;        this.admin = admin;&#10;        this.admin = admin;&#10;&#10;" />
              <option name="updatedContent" value="package org.models;&#10;&#10;public abstract class User {&#10;    private final String username;&#10;&#10;    protected User(String username) {&#10;        this.username = username;&#10;    }&#10;&#10;    public String getUsername() { return username; }&#10;&#10;    // Role helpers - override in subclasses as needed&#10;    public boolean isAdmin() { return false; }&#10;    public boolean isWaiter() { return false; }&#10;    public boolean isChef() { return false; }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/java/org/models/Waiter.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/org/models/Waiter.java" />
              <option name="updatedContent" value="package org.models;&#10;&#10;public class Waiter extends User {&#10;    public Waiter(String username) {&#10;        super(username);&#10;    }&#10;&#10;    @Override&#10;    public boolean isWaiter() { return true; }&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>